$NetBSD: patch-dj,v 1.1.2.1 2008/07/10 13:00:01 tron Exp $

Avoid memory size integer overflow memory exhaustion DoS in filling
arrays (SN-2008-02).

--- array.c.orig	2008-06-20 15:53:16.000000000 +0900
+++ array.c
@@ -2272,10 +2272,10 @@ rb_ary_fill(argc, argv, ary)
 	break;
     }
     rb_ary_modify(ary);
-    end = beg + len;
-    if (end < 0) {
+    if (beg >= ARY_MAX_SIZE || len > ARY_MAX_SIZE - beg) {
 	rb_raise(rb_eArgError, "argument too big");
     }
+    end = beg + len;
     if (end > RARRAY(ary)->len) {
 	if (end >= RARRAY(ary)->aux.capa) {
 	    REALLOC_N(RARRAY(ary)->ptr, VALUE, end);
