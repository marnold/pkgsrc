$NetBSD: patch-aa,v 1.1.2.2 2006/10/29 16:47:58 ghen Exp $

# CVE-2006-4812

--- Zend/zend_alloc.c.orig	2006-08-10 18:16:24.000000000 +0100
+++ Zend/zend_alloc.c
@@ -331,12 +331,12 @@ ZEND_API void *_ecalloc(size_t nmemb, si
 	int final_size = size*nmemb;
 	
 	HANDLE_BLOCK_INTERRUPTIONS();
-	p = _emalloc(final_size ZEND_FILE_LINE_RELAY_CC ZEND_FILE_LINE_ORIG_RELAY_CC);
+	p = _safe_emalloc(nmemb, size, 0 ZEND_FILE_LINE_RELAY_CC ZEND_FILE_LINE_ORIG_RELAY_CC);
 	if (!p) {
 		HANDLE_UNBLOCK_INTERRUPTIONS();
 		return (void *) p;
 	}
-	memset(p, 0, final_size);
+	memset(p, 0, size * nmemb);
 	HANDLE_UNBLOCK_INTERRUPTIONS();
 	return p;
 }
