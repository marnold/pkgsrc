$NetBSD: patch-ac,v 1.1.1.1 2004/05/10 13:41:10 wiz Exp $

--- Makefile.orig	Wed Aug 15 15:12:07 2001
+++ Makefile	Fri Mar 22 12:43:45 2002
@@ -3,8 +3,8 @@
 #
 include config.mak
 
-CFLAGS= $(OPTFLAGS) -Wall -g -I./libavcodec -I./libav 
-LDFLAGS= -g 
+CFLAGS= $(OPTFLAGS) -Wall -I./libavcodec -I./libav -I$(LOCALBASE)/include 
+LDFLAGS= -L$(LOCALBASE)/lib
 ifeq ($(TARGET_GPROF),yes)
 CFLAGS+=-p
 LDFLAGS+=-p
@@ -18,17 +18,19 @@
 	$(MAKE) -C libavcodec all
 	$(MAKE) -C libav all
 
-ffmpeg: ffmpeg.o libav/libav.a libavcodec/libavcodec.a
-	gcc $(LDFLAGS) -o $@ $^ -lm
+ffmpeg: ffmpeg.o libav/libav.la libavcodec/libavcodec.la
+	$(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o $@ $^ -lm
 
-ffserver: ffserver.o libav/libav.a libavcodec/libavcodec.a
-	gcc $(LDFLAGS) -o $@ $^ -lm
+ffserver: ffserver.o libav/libav.la libavcodec/libavcodec.la
+	$(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o $@ $^ -lm $(EXTRA_LIBS)
 
 %.o: %.c
-	gcc $(CFLAGS) -c -o $@ $< 
+	$(CC) -DFFSERVER_CONF=\"$(FFSERVER_CONF)\" $(CFLAGS) -c -o $@ $< 
 
 install: all
-	install -s -m 755 $(PROG) $(prefix)/bin
+	$(MAKE) -C libavcodec install
+	$(MAKE) -C libav install
+	$(LIBTOOL) --mode=install $(BSD_INSTALL_PROGRAM) $(PROG) $(prefix)/bin
 
 clean: 
 	$(MAKE) -C libavcodec clean
