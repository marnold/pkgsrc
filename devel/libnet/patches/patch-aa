$NetBSD: patch-aa,v 1.1.1.1 1999/11/08 08:25:02 sakamoto Exp $

--- ./Makefile.in.orig	Thu Oct 28 08:44:26 1999
+++ ./Makefile.in	Mon Nov  8 11:23:32 1999
@@ -21,5 +21,5 @@
 LIBNET      =   libnet
 LIBPWRITE   =   libpwrite
-LIB         =   lib/$(LIBNET).a
+LIB         =   $(LIBNET).a
 MAN         =   doc/$(LIBNET).3
 INCLUDE     =   include/$(LIBNET).h
@@ -68,12 +68,13 @@
 
 .c.o:
-	$(CC) $(CFLAGS) $(CPPFLAGS) $(DEFINES) -c $< -o $@
+	$(LIBTOOL) --mode=compile $(CC) $(CFLAGS) $(CPPFLAGS) $(DEFINES) -c $<
+	ln -s $(@:C|src|..|) src
 
 all: libnet
 supp: test example
 
-libnet: version.h $(OBJECTS)
-	$(AR) -cr $(LIB) $(OBJECTS)
-	$(RANLIB) $(LIB)
+libnet: $(LIB)
+$(LIB): version.h $(OBJECTS)
+	$(LIBTOOL) --mode=link $(CC) -o $(LIB:.a=.la) $(OBJECTS:C|src/||:.o=.lo) -rpath $(LIB_PREFIX) -version-info 1:0
 
 version.o: version.h
@@ -92,13 +93,6 @@
 
 install: libnet
-	$(ENSUREDIR) $(DESTDIR)$(prefix) 755
-	$(ENSUREDIR) $(DESTDIR)$(LIB_PREFIX) 755
 	$(ENSUREDIR) $(DESTDIR)$(INC_PREFIX)$(LIBNET) 755
-	$(ENSUREDIR) $(DESTDIR)$(INC_PREFIX) 755
-	$(ENSUREDIR) $(DESTDIR)$(MAN_PREFIX) 755
-	$(ENSUREDIR) $(DESTDIR)$(BIN_PREFIX) 755
-	$(INSTALL) -c -m 0644 $(LIB) $(DESTDIR)$(LIB_PREFIX)
-	rm -f $(DESTDIR)$(LIB_PREFIX)$(LIBPWRITE)
-	$(LN) -f -s $(DESTDIR)$(LIB_PREFIX)$(LIBNET).a $(DESTDIR)$(LIB_PREFIX)$(LIBPWRITE)
+	$(LIBTOOL) --mode=install $(INSTALL) -c -m 0644 $(LIB:.a=.la) $(DESTDIR)$(LIB_PREFIX)
 	$(INSTALL) -c -m 0644 $(INCLUDE) $(DESTDIR)$(INC_PREFIX)
 	$(INSTALL) -c -m 0644 $(INCLUDE-H) $(DESTDIR)$(INC_PREFIX)$(LIBNET)
@@ -110,4 +104,5 @@
 	$(INSTALL) -c -m 0644 $(MAN) $(DESTDIR)$(MAN_PREFIX)
 	$(INSTALL) -c -m 0755 $(CONFIG) $(DESTDIR)$(BIN_PREFIX)
+	$(LIBTOOL) --mode=finish $(DESTDIR)$(LIB_PREFIX)
 
 clean:
