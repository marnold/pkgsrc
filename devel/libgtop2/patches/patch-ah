$NetBSD: patch-ah,v 1.1.1.1 2002/11/04 02:56:17 rh Exp $

--- sysdeps/freebsd/procmap.c.orig	Thu May 27 20:56:48 1999
+++ sysdeps/freebsd/procmap.c	Wed Nov 29 21:57:15 2000
@@ -32,9 +32,13 @@
 #include <sys/param.h>
 #include <sys/proc.h>
 #include <sys/resource.h>
+#if defined(__NetBSD__) && (__NetBSD_Version__ < 105020000)
 #include <vm/vm_object.h>
 #include <vm/vm_prot.h>
 #include <vm/vm_map.h>
+#else
+#include <uvm/uvm_extern.h>
+#endif
 
 #include <sys/vnode.h>
 #include <sys/mount.h>
@@ -46,9 +50,12 @@
 #include <sys/user.h>
 #endif
 #include <sys/sysctl.h>
+#if defined(__NetBSD__) && (__NetBSD_Version__ < 105020000)
 #include <vm/vm.h>
+#endif
 
-#if defined(__NetBSD__) && (__NetBSD_Version__ >= 104000000)
+#if defined(__NetBSD__) && \
+	(__NetBSD_Version__ >= 104000000) && (__NetBSD_Version < 105020000)
 /* Fixme ... */
 #undef _KERNEL
 #define _UVM_UVM_AMAP_I_H_ 1
@@ -214,11 +221,13 @@
 #endif
 
 #if defined(__NetBSD__) && (__NetBSD_Version__ >= 104000000)
+#if defined(UVM_VNODE_VALID)
 		if (!vnode.v_uvm.u_flags & UVM_VNODE_VALID)
 			continue;
 
 		if ((vnode.v_type != VREG) || (vnode.v_tag != VT_UFS) ||
 		    !vnode.v_data) continue;
+#endif
 
 		if (kvm_read (server->machine.kd,
 			      (unsigned long) vnode.v_data,
