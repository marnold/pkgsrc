$NetBSD: patch-aa,v 1.1.1.1 2004/12/03 14:25:39 wiz Exp $

--- Makefile.in.orig	Wed Jul 26 19:24:58 2000
+++ Makefile.in
@@ -617,7 +617,7 @@ install-data-local:
 	$(INSTALL_DATA) ./gtk/config.scm  $(gtkmoduledir)/config.scm
 	$(INSTALL_DATA) $(srcdir)/gtk/event-repl.scm $(gtkmoduledir)/event-repl.scm
 .c.x:
-	guile-snarf $(DEFS) $(INCLUDES) $(CPPFLAGS) $(CFLAGS) $< >$<.tmp && mv $<.tmp $@
+	guile-snarf $< $(DEFS) $(INCLUDES) $(CPPFLAGS) $(CFLAGS) >$<.tmp && mv $<.tmp $@
 
 gtk-glue.c: $(gtkdefs) $(gdkdefs) build-guile-gtk
 	$(BUILD) -I $(srcdir) glue $(gtkdefs) >tmpt && mv tmpt $@
@@ -641,3 +641,20 @@ dist-hook:
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
 # Otherwise a system limit (for SysV at least) may be exceeded.
 .NOEXPORT:
+
+# problems with optimization. triggers internal compiler errors
+
+COMPILE_NOOPT=${COMPILE:C/-O[0-9]*//g}
+LTCOMPILE_NOOPT=${LTCOMPILE:C/-O[0-9]*//g}
+
+.if (${MACHINE_ARCH} == "alpha")
+
+gdk-glue.o: gdk-glue.c
+	$(COMPILE_NOOPT) -c gdk-glue.c
+
+gdk-glue.lo: gdk-glue.c
+	@echo "Compiling without optimization to work around gcc -O* compiler bug"
+	$(LTCOMPILE_NOOPT) -c gdk-glue.c
+
+.endif
+
