$NetBSD: patch-aa,v 1.1.1.1 2005/01/13 09:27:06 manu Exp $
--- configure.orig	2005-01-01 14:38:16.000000000 +0100
+++ configure	2005-01-12 23:58:45.000000000 +0100
@@ -13,9 +13,8 @@
 else
 	echo "This script asks a few questions and builds a Makefile to compile Hobbit"
 	echo ""
 	echo "Are you setting up a Hobbit server (hobbit), or using Hobbit with BB (bb) [hobbit] ?"
-	read TARGET
 	if test -z "$TARGET"
 	then
 		TARGET="hobbit"
 	fi
@@ -48,9 +47,11 @@
 		echo "like POP3S, IMAPS, NNTPS and TELNETS. If you have the OpenSSL"
 		echo "library installed, I recommend that you enable this."
 		echo ""
 		echo "Do you want to be able to test SSL-enabled services (y) ?"
-		read ENABLESSL
+		if test -z "$ENABLESSL" ; then
+			read ENABLESSL
+		fi
 		if test "$ENABLESSL" = "" -o "$ENABLESSL" = "y"
 		then
 			SSLDEF="-DBBGEN_SSL"
 		else
@@ -69,9 +70,11 @@
 		echo ""
 		echo "Hobbit can use your $LDAPVENDOR LDAP client library to test LDAP servers."
 		echo ""
 		echo "Do you want to be able to test LDAP servers (y) ?"
-		read ENABLELDAP
+		if test -z "$ENABLELDAP" ; then
+			read ENABLELDAP
+		fi
 		if test "$ENABLELDAP" = "" -o "$ENABLELDAP" = "y"
 		then
 			if test "$LDAPVENDOR" = "OpenLDAP"; then
 				echo "Enable experimental support for LDAP/SSL (OpenLDAP 2.x only) (y) ?"
@@ -177,57 +180,68 @@
 		echo "Setting up for a Hobbit server"
 		echo ""; echo ""
 
 		echo "What userid will be running Hobbit [hobbit] ?"
-		read BBUSER
+		if test -z "$BBUSER" ; then
+			read BBUSER
+		fi
 		if test -z "$BBUSER"
 		then
 			BBUSER="hobbit"
 		fi
-		USERDATA=`getent passwd $BBUSER || grep "^${BBUSER}:" /etc/passwd`
+		USERDATA=`awk -F: -vbbuser=${BBUSER} '($1 == bbuser){print $5}' /etc/passwd`
 		if test $? -eq 0
 		then
 			echo "Found passwd entry for user $USERDATA"
 		else
 			echo "FAILURE: The user $BBUSER does not exist. Create user and try again."
 			exit 1
+		A
 		fi
 		echo ""; echo ""
 
 		HOMEDIR="`echo $USERDATA|cut -d: -f6`"
 		echo "Where do you want the Hobbit installation [${HOMEDIR}] ?"
-		read BBTOPDIR
+		if test -z "$BBTOPDIR" ; then
+			read BBTOPDIR
+		fi
 		if test -z "$BBTOPDIR"
 		then
 			BBTOPDIR=${HOMEDIR}
 		fi
-		if test -d "$BBTOPDIR"
-		then
-			echo "OK, will configure to use $BBTOPDIR as the Hobbit toplevel directory"
-		else
-			echo "** FAILURE: $BBTOPDIR does not exist. Create it and try again."
-			exit 1
-		fi
+#		if test -d "$BBTOPDIR"
+#		then
+#			echo "OK, will configure to use $BBTOPDIR as the Hobbit toplevel directory"
+#		else
+#			echo "** FAILURE: $BBTOPDIR does not exist. Create it and try again."
+#			exit 1
+#		fi
 		echo ""; echo ""
 
 		echo "What URL will you use for the Hobbit webpages [/hobbit] ? "
-		read BBHOSTURL
+		if test -z "$BBHOSTURL"; then
+			read BBHOSTURL
+		fi
 		if test -z "$BBHOSTURL"
 		then
 			BBHOSTURL="/hobbit"
 		fi
 		echo ""; echo ""
 
 		echo "Where to put the Hobbit CGI scripts [$BBTOPDIR/cgi-bin] ? "
-		read CGIDIR
+		if test -z "$CGIDIR"; then
+			read CGIDIR
+		fi
 		if test -z "$CGIDIR"
 		then
 			CGIDIR=$BBTOPDIR/cgi-bin
 		fi
 		echo ""; echo ""
 
 		echo "What is the URL for the Hobbit CGI directory [/hobbit-cgi] ? "
-		read BBCGIURL
+		if test -z "$BBCGIURL" ; then
+			read BBCGIURL
+		fi
 		if test -z "$BBCGIURL"
 		then
 			BBCGIURL="/hobbit-cgi"
 		fi
@@ -244,29 +258,35 @@
 		echo "'nobody' or 'apache' or 'www-data'"
 		echo "If you dont know, just hit ENTER and we will handle it later."
 		echo ""
 		echo "What group-ID does your webserver use ?"
-		read HTTPDGID
+		if test -z "$HTTPDGID" ; then
+			read HTTPDGID
+		fi
 		echo ""; echo ""
 
 		echo "Where to put the Hobbit logfiles [/var/log/hobbit] ? "
-		read BBLOGDIR
+		if test -z "$BBLOGDIR" ; then
+			read BBLOGDIR
+		fi
 		if test -z "$BBLOGDIR"
 		then
 			BBLOGDIR=/var/log/hobbit
 		fi
 		echo ""; echo ""
 
-		echo "What is the name of this host [`uname -n`] ? "
-		read BBHOSTNAME
+#		echo "What is the name of this host [`uname -n`] ? "
+#		read BBHOSTNAME
 		if test -z "$BBHOSTNAME"
 		then
 			BBHOSTNAME=`uname -n`
 		fi
 		echo ""; echo ""
 
 		echo "What is the IP-address of this host [127.0.0.1] ? "
-		read BBHOSTIP
+		if test -z "$BBHOSTIP" ; then
+			read BBHOSTIP
+		fi
 		if test -z "$BBHOSTIP"
 		then
 			echo "** NOTE: Using 127.0.0.1 (loopback), but it is probably not what you want **"
 			BBHOSTIP=127.0.0.1
@@ -281,9 +301,11 @@
 		MAXMSG=32768
 	fi
 
 	echo "Where should I install the Hobbit man-pages (/usr/local/man) ?"
-	read MANROOT
+	if test -z "$MANROOT" ; then
+		read MANROOT
+	fi
 	if test -z "$MANROOT"
 	then
 		MANROOT=/usr/local/man
 	fi
@@ -293,9 +315,11 @@
 	echo "graph of the history. It can also show a 1-week, 4-weeks and"
 	echo "1-year graphs, or any combination of these."
 	echo ""
 	echo "Which graphs to show by default (1d/1w/4w/1y/all) [all]"
-	read BARS
+	if test -z "$BARS" ; then
+		read BARS
+	fi
 	if test "$BARS" = "all" -o "$BARS" = ""
 	then
 		BARSUMS=15
 		export BARSUMS
@@ -341,9 +365,11 @@
 	echo "graph instead of the standard Big Brother graph that automatically"
 	echo "resizes to fit your browser window."
 	echo ""
 	echo "Use the new detailed Hobbit history graph (y/n) [y] ? "
-	read USENEWHIST
+	if test -z "$USENEWHIST"  ; then
+		read USENEWHIST
+	fi
 	if test "$USENEWHIST" = "" -o "$USENEWHIST" = "y"
 	then
 		echo "   Tell me the display width (in pixels) to use for"
 		echo "   the history graph. This could be anything, but to"
@@ -351,9 +377,11 @@
 		echo "   is best to use a multiple of 24."
 		echo "   The default value (960) is good on 1024x768 displays"
 		echo ""
 		echo "   What width should I use for the graph [960] ? "
-		read PIXELCOUNT
+		if test -z "$PIXELCOUNT" ; then
+			read PIXELCOUNT
+		fi
 		if test "$PIXELCOUNT" = ""
 		then
 			HISTGRAPHDEF="-DDEFPIXELS=960"
 			export HISTGRAPHDEF
