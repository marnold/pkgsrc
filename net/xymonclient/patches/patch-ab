$NetBSD: patch-ab,v 1.1.1.1 2010/02/14 16:11:11 spz Exp $

--- build/Makefile.rules.orig	2009-02-12 13:00:50.000000000 +0000
+++ build/Makefile.rules
@@ -34,6 +34,9 @@ endif
 ifndef INSTALLETCDIR
 INSTALLETCDIR = $(BBHOME)/etc
 endif
+ifndef INSTALLEXADIR
+INSTALLEXADIR = $(BBHOME)/etc
+endif
 ifndef INSTALLEXTDIR
 INSTALLEXTDIR = $(BBHOME)/ext
 endif
@@ -156,58 +159,67 @@ install-servermsg:
 	@echo "To view the Hobbit webpages, go to http://${BBHOSTNAME}${BBHOSTURL}"
 
 install-dirs:
-	mkdir -p $(INSTALLROOT)$(BBHOME) $(INSTALLROOT)$(BBHOME)/download $(INSTALLROOT)$(BBVAR)
+	mkdir -p $(INSTALLROOT)$(BBHOME) $(INSTALLROOT)$(BBVAR)
+
+	mkdir -p $(INSTALLROOT)$(BBVAR)/download
+ifndef PKGBUILD
+ifneq ($(BBVAR),$(BBHOME))
+	ln -sf $(BBVAR)/download $(INSTALLROOT)$(BBHOME)/download
+endif
+endif
 
 	mkdir -p $(INSTALLROOT)$(INSTALLBINDIR)
+ifndef PKGBUILD
 ifneq ($(INSTALLBINDIR),$(BBHOME)/bin)
 	ln -sf $(INSTALLBINDIR) $(INSTALLROOT)$(BBHOME)/bin
 endif
-ifndef PKGBUILD
 	chown $(BBUSER) $(INSTALLROOT)$(INSTALLBINDIR)
 	chgrp `$(IDTOOL) -g $(BBUSER)` $(INSTALLROOT)$(INSTALLBINDIR)
 endif
 
 	mkdir -p $(INSTALLROOT)$(INSTALLETCDIR)
+ifndef PKGBUILD
 ifneq ($(INSTALLETCDIR),$(BBHOME)/etc)
 	ln -sf $(INSTALLETCDIR) $(INSTALLROOT)$(BBHOME)/etc
 endif
-ifndef PKGBUILD
 	chown $(BBUSER) $(INSTALLROOT)$(INSTALLETCDIR)
 	chgrp `$(IDTOOL) -g $(BBUSER)` $(INSTALLROOT)$(INSTALLETCDIR)
 endif
 
+	mkdir -p $(INSTALLROOT)$(INSTALLEXADIR)
+
 	mkdir -p $(INSTALLROOT)$(INSTALLEXTDIR)
+ifndef PKGBUILD
 ifneq ($(INSTALLEXTDIR),$(BBHOME)/ext)
 	ln -sf $(INSTALLEXTDIR) $(INSTALLROOT)$(BBHOME)/ext
 endif
-ifndef PKGBUILD
 	chown $(BBUSER) $(INSTALLROOT)$(INSTALLEXTDIR)
 	chgrp `$(IDTOOL) -g $(BBUSER)` $(INSTALLROOT)$(INSTALLEXTDIR)
 endif
 
 	mkdir -p $(INSTALLROOT)$(INSTALLTMPDIR)
+ifndef PKGBUILD
 ifneq ($(INSTALLTMPDIR),$(BBHOME)/tmp)
 	ln -sf $(INSTALLTMPDIR) $(INSTALLROOT)$(BBHOME)/tmp
 endif
-ifndef PKGBUILD
 	chown $(BBUSER) $(INSTALLROOT)$(INSTALLTMPDIR)
 	chgrp `$(IDTOOL) -g $(BBUSER)` $(INSTALLROOT)$(INSTALLTMPDIR)
 endif
 
 	mkdir -p $(INSTALLROOT)$(INSTALLWEBDIR)
+ifndef PKGBUILD
 ifneq ($(INSTALLWEBDIR),$(BBHOME)/web)
 	ln -sf $(INSTALLWEBDIR) $(INSTALLROOT)$(BBHOME)/web
 endif
-ifndef PKGBUILD
 	chown $(BBUSER) $(INSTALLROOT)$(INSTALLWEBDIR)
 	chgrp `$(IDTOOL) -g $(BBUSER)` $(INSTALLROOT)$(INSTALLWEBDIR)
 endif
 
 	mkdir -p $(INSTALLROOT)$(INSTALLWWWDIR) $(INSTALLROOT)$(INSTALLWWWDIR)/gifs $(INSTALLROOT)$(INSTALLWWWDIR)/help $(INSTALLROOT)$(INSTALLWWWDIR)/html $(INSTALLROOT)$(INSTALLWWWDIR)/menu $(INSTALLROOT)$(INSTALLWWWDIR)/notes $(INSTALLROOT)$(INSTALLWWWDIR)/rep $(INSTALLROOT)$(INSTALLWWWDIR)/snap $(INSTALLROOT)$(INSTALLWWWDIR)/wml
+ifndef PKGBUILD
 ifneq ($(INSTALLWWWDIR),$(BBHOME)/www)
 	ln -sf $(INSTALLWWWDIR) $(INSTALLROOT)$(BBHOME)/www
 endif
-ifndef PKGBUILD
 	chown $(BBUSER) $(INSTALLROOT)$(INSTALLWWWDIR) $(INSTALLROOT)$(INSTALLWWWDIR)/gifs $(INSTALLROOT)$(INSTALLWWWDIR)/help $(INSTALLROOT)$(INSTALLWWWDIR)/html $(INSTALLROOT)$(INSTALLWWWDIR)/menu $(INSTALLROOT)$(INSTALLWWWDIR)/notes $(INSTALLROOT)$(INSTALLWWWDIR)/rep $(INSTALLROOT)$(INSTALLWWWDIR)/snap $(INSTALLROOT)$(INSTALLWWWDIR)/wml
 	chgrp `$(IDTOOL) -g $(BBUSER)`  $(INSTALLROOT)$(INSTALLWWWDIR) $(INSTALLROOT)$(INSTALLWWWDIR)/gifs $(INSTALLROOT)$(INSTALLWWWDIR)/help $(INSTALLROOT)$(INSTALLWWWDIR)/html $(INSTALLROOT)$(INSTALLWWWDIR)/menu $(INSTALLROOT)$(INSTALLWWWDIR)/notes $(INSTALLROOT)$(INSTALLWWWDIR)/rep $(INSTALLROOT)$(INSTALLWWWDIR)/snap $(INSTALLROOT)$(INSTALLWWWDIR)/wml
 ifdef HTTPDGID
@@ -266,5 +278,5 @@ ifndef PKGBUILD
 endif
 
 install-common: install-dirs
-	BBHOME="$(BBHOME)" MANROOT="$(MANROOT)" INSTALLROOT="$(INSTALLROOT)" INSTALLBINDIR="$(INSTALLBINDIR)" INSTALLETCDIR="$(INSTALLETCDIR)" INSTALLEXTDIR="$(INSTALLEXTDIR)" INSTALLTMPDIR="$(INSTALLTMPDIR)" INSTALLWEBDIR="$(INSTALLWEBDIR)" INSTALLWWWDIR="$(INSTALLWWWDIR)" $(MAKE) -C common install
+	BBHOME="$(BBHOME)" MANROOT="$(MANROOT)" INSTALLROOT="$(INSTALLROOT)" INSTALLBINDIR="$(INSTALLBINDIR)" INSTALLETCDIR="$(INSTALLEXADIR)" INSTALLEXTDIR="$(INSTALLEXTDIR)" INSTALLTMPDIR="$(INSTALLTMPDIR)" INSTALLWEBDIR="$(INSTALLWEBDIR)" INSTALLWWWDIR="$(INSTALLWWWDIR)" $(MAKE) -C common install
 
@@ -297,16 +309,16 @@ install-man:
 	BBHOME="$(BBHOME)" MANROOT="$(MANROOT)" INSTALLROOT="$(INSTALLROOT)" $(MAKE) -C web install-man
 
 install-docs:
-	BBHOME="$(BBHOME)" MANROOT="$(MANROOT)" INSTALLROOT="$(INSTALLROOT)" INSTALLBINDIR="$(INSTALLBINDIR)" INSTALLETCDIR="$(INSTALLETCDIR)" INSTALLEXTDIR="$(INSTALLEXTDIR)" INSTALLTMPDIR="$(INSTALLTMPDIR)" INSTALLWEBDIR="$(INSTALLWEBDIR)" INSTALLWWWDIR="$(INSTALLWWWDIR)" $(MAKE) -C docs install
+	BBHOME="$(BBHOME)" MANROOT="$(MANROOT)" INSTALLROOT="$(INSTALLROOT)" INSTALLBINDIR="$(INSTALLBINDIR)" INSTALLETCDIR="$(INSTALLEXADIR)" INSTALLEXTDIR="$(INSTALLEXTDIR)" INSTALLTMPDIR="$(INSTALLTMPDIR)" INSTALLWEBDIR="$(INSTALLWEBDIR)" INSTALLWWWDIR="$(INSTALLWWWDIR)" $(MAKE) -C docs install
 
 install-custom:
-	BBHOME="$(BBHOME)" MANROOT="$(MANROOT)" INSTALLROOT="$(INSTALLROOT)" INSTALLBINDIR="$(INSTALLBINDIR)" INSTALLETCDIR="$(INSTALLETCDIR)" INSTALLEXTDIR="$(INSTALLEXTDIR)" INSTALLTMPDIR="$(INSTALLTMPDIR)" INSTALLWEBDIR="$(INSTALLWEBDIR)" INSTALLWWWDIR="$(INSTALLWWWDIR)" $(MAKE) -C custom install || echo "Skipped custom modules"
+	BBHOME="$(BBHOME)" MANROOT="$(MANROOT)" INSTALLROOT="$(INSTALLROOT)" INSTALLBINDIR="$(INSTALLBINDIR)" INSTALLETCDIR="$(INSTALLEXADIR)" INSTALLEXTDIR="$(INSTALLEXTDIR)" INSTALLTMPDIR="$(INSTALLTMPDIR)" INSTALLWEBDIR="$(INSTALLWEBDIR)" INSTALLWWWDIR="$(INSTALLWWWDIR)" $(MAKE) -C custom install || echo "Skipped custom modules"
 
 
 client-install: install-client
 
 install-client: client
-	BBHOME="$(BBTOPDIR)/client" INSTALLROOT="$(INSTALLROOT)" BBUSER="$(BBUSER)" LOCALCLIENT="$(LOCALCLIENT)" $(MAKE) -C client install
+	BBHOME="$(BBHOME)/client" INSTALLTMPDIR="$(INSTALLTMPDIR)/client" INSTALLEXTDIR="$(INSTALLEXTDIR)/client" INSTALLETCDIR="$(INSTALLEXADIR)" INSTALLBINDIR="$(INSTALLBINDIR)/client" BBLOGDIR="$(BBLOGDIR)" BBUSER="$(BBUSER)" LOCALCLIENT="$(LOCALCLIENT)" $(MAKE) -C client install
 
 install-clientmsg:
 	@echo ""
@@ -315,5 +327,5 @@ install-clientmsg:
 	@echo "To start the Hobbit client, as the $(BBUSER) user run '${BBHOME}/runclient.sh start'"
 
 install-localclient:
-	BBHOME="$(BBTOPDIR)/client" INSTALLROOT="$(INSTALLROOT)" BBUSER="$(BBUSER)" LOCALCLIENT="$(LOCALCLIENT)" $(MAKE) -C client install-localclient
+	BBHOME="$(BBHOME)/client" INSTALLTMPDIR="$(INSTALLTMPDIR)/client" INSTALLEXTDIR="$(INSTALLEXTDIR)/client" INSTALLETCDIR="$(INSTALLEXADIR)" INSTALLBINDIR="$(INSTALLBINDIR)/client" BBLOGDIR="$(BBLOGDIR)" BBUSER="$(BBUSER)" LOCALCLIENT="$(LOCALCLIENT)" $(MAKE) -C client install-localclient
 
