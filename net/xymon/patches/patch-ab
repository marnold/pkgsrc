$NetBSD: patch-ab,v 1.1.1.1 2010/02/14 22:58:58 spz Exp $

--- build/Makefile.rules.orig	2009-02-12 13:00:50.000000000 +0000
+++ build/Makefile.rules
@@ -22,9 +22,9 @@ else
 	INSTALLTARGETS = install-client install-clientmsg
 endif
 else
-	BUILDTARGETS = lib-build common-build bbdisplay-build bbnet-build bbproxy-build docs-build build-build hobbitd-build web-build client
-	CLIENTTARGETS = lib-client common-client build-build
-	INSTALLTARGETS = install-bbdisplay install-bbnet install-bbproxy install-man install-hobbitd install-web install-docs install-client install-servermsg
+	BUILDTARGETS = lib-build common-build bbdisplay-build bbnet-build bbproxy-build docs-build build-build hobbitd-build web-build # client
+	CLIENTTARGETS = # lib-client common-client build-build
+	INSTALLTARGETS = install-bbdisplay install-bbnet install-bbproxy install-man install-hobbitd install-web install-docs install-servermsg # install-client
 	CFLAGS += $(PCREINCDIR)
 endif
 
@@ -34,6 +34,9 @@ endif
 ifndef INSTALLETCDIR
 INSTALLETCDIR = $(BBHOME)/etc
 endif
+ifndef INSTALLEXADIR
+INSTALLEXADIR = $(BBHOME)/etc
+endif
 ifndef INSTALLEXTDIR
 INSTALLEXTDIR = $(BBHOME)/ext
 endif
@@ -156,58 +159,67 @@ install-servermsg:
 	@echo "To view the Hobbit webpages, go to http://${BBHOSTNAME}${BBHOSTURL}"
 
 install-dirs:
-	mkdir -p $(INSTALLROOT)$(BBHOME) $(INSTALLROOT)$(BBHOME)/download $(INSTALLROOT)$(BBVAR)
+	mkdir -p $(INSTALLROOT)$(BBHOME) $(INSTALLROOT)$(BBVAR)
+
+	mkdir -p $(INSTALLROOT)$(BBVAR)/download
+ifndef PKGBUILD
+ifneq ($(BBVAR),$(BBHOME))
+	ln -sf $(BBVAR)/download $(INSTALLROOT)$(BBHOME)/download
+endif
+endif
 
 	mkdir -p $(INSTALLROOT)$(INSTALLBINDIR)
+ifndef PKGBUILD
 ifneq ($(INSTALLBINDIR),$(BBHOME)/bin)
 	ln -sf $(INSTALLBINDIR) $(INSTALLROOT)$(BBHOME)/bin
 endif
-ifndef PKGBUILD
 	chown $(BBUSER) $(INSTALLROOT)$(INSTALLBINDIR)
 	chgrp `$(IDTOOL) -g $(BBUSER)` $(INSTALLROOT)$(INSTALLBINDIR)
 endif
 
 	mkdir -p $(INSTALLROOT)$(INSTALLETCDIR)
+ifndef PKGBUILD
 ifneq ($(INSTALLETCDIR),$(BBHOME)/etc)
 	ln -sf $(INSTALLETCDIR) $(INSTALLROOT)$(BBHOME)/etc
 endif
-ifndef PKGBUILD
 	chown $(BBUSER) $(INSTALLROOT)$(INSTALLETCDIR)
 	chgrp `$(IDTOOL) -g $(BBUSER)` $(INSTALLROOT)$(INSTALLETCDIR)
 endif
 
+	mkdir -p $(INSTALLROOT)$(INSTALLEXADIR)
+
 	mkdir -p $(INSTALLROOT)$(INSTALLEXTDIR)
+ifndef PKGBUILD
 ifneq ($(INSTALLEXTDIR),$(BBHOME)/ext)
 	ln -sf $(INSTALLEXTDIR) $(INSTALLROOT)$(BBHOME)/ext
 endif
-ifndef PKGBUILD
 	chown $(BBUSER) $(INSTALLROOT)$(INSTALLEXTDIR)
 	chgrp `$(IDTOOL) -g $(BBUSER)` $(INSTALLROOT)$(INSTALLEXTDIR)
 endif
 
 	mkdir -p $(INSTALLROOT)$(INSTALLTMPDIR)
+ifndef PKGBUILD
 ifneq ($(INSTALLTMPDIR),$(BBHOME)/tmp)
 	ln -sf $(INSTALLTMPDIR) $(INSTALLROOT)$(BBHOME)/tmp
 endif
-ifndef PKGBUILD
 	chown $(BBUSER) $(INSTALLROOT)$(INSTALLTMPDIR)
 	chgrp `$(IDTOOL) -g $(BBUSER)` $(INSTALLROOT)$(INSTALLTMPDIR)
 endif
 
 	mkdir -p $(INSTALLROOT)$(INSTALLWEBDIR)
+ifndef PKGBUILD
 ifneq ($(INSTALLWEBDIR),$(BBHOME)/web)
 	ln -sf $(INSTALLWEBDIR) $(INSTALLROOT)$(BBHOME)/web
 endif
-ifndef PKGBUILD
 	chown $(BBUSER) $(INSTALLROOT)$(INSTALLWEBDIR)
 	chgrp `$(IDTOOL) -g $(BBUSER)` $(INSTALLROOT)$(INSTALLWEBDIR)
 endif
 
 	mkdir -p $(INSTALLROOT)$(INSTALLWWWDIR) $(INSTALLROOT)$(INSTALLWWWDIR)/gifs $(INSTALLROOT)$(INSTALLWWWDIR)/help $(INSTALLROOT)$(INSTALLWWWDIR)/html $(INSTALLROOT)$(INSTALLWWWDIR)/menu $(INSTALLROOT)$(INSTALLWWWDIR)/notes $(INSTALLROOT)$(INSTALLWWWDIR)/rep $(INSTALLROOT)$(INSTALLWWWDIR)/snap $(INSTALLROOT)$(INSTALLWWWDIR)/wml
+ifndef PKGBUILD
 ifneq ($(INSTALLWWWDIR),$(BBHOME)/www)
 	ln -sf $(INSTALLWWWDIR) $(INSTALLROOT)$(BBHOME)/www
 endif
-ifndef PKGBUILD
 	chown $(BBUSER) $(INSTALLROOT)$(INSTALLWWWDIR) $(INSTALLROOT)$(INSTALLWWWDIR)/gifs $(INSTALLROOT)$(INSTALLWWWDIR)/help $(INSTALLROOT)$(INSTALLWWWDIR)/html $(INSTALLROOT)$(INSTALLWWWDIR)/menu $(INSTALLROOT)$(INSTALLWWWDIR)/notes $(INSTALLROOT)$(INSTALLWWWDIR)/rep $(INSTALLROOT)$(INSTALLWWWDIR)/snap $(INSTALLROOT)$(INSTALLWWWDIR)/wml
 	chgrp `$(IDTOOL) -g $(BBUSER)`  $(INSTALLROOT)$(INSTALLWWWDIR) $(INSTALLROOT)$(INSTALLWWWDIR)/gifs $(INSTALLROOT)$(INSTALLWWWDIR)/help $(INSTALLROOT)$(INSTALLWWWDIR)/html $(INSTALLROOT)$(INSTALLWWWDIR)/menu $(INSTALLROOT)$(INSTALLWWWDIR)/notes $(INSTALLROOT)$(INSTALLWWWDIR)/rep $(INSTALLROOT)$(INSTALLWWWDIR)/snap $(INSTALLROOT)$(INSTALLWWWDIR)/wml
 ifdef HTTPDGID
@@ -215,6 +227,8 @@ ifdef HTTPDGID
 	chgrp $(HTTPDGID) $(INSTALLROOT)$(INSTALLWWWDIR)/rep $(INSTALLROOT)$(INSTALLWWWDIR)/snap
 endif
 	chmod g+w $(INSTALLROOT)$(INSTALLWWWDIR)/rep $(INSTALLROOT)$(INSTALLWWWDIR)/snap
+else
+	mkdir -p $(INSTALLROOT)$(INSTALLEXADIR)/www $(INSTALLROOT)$(INSTALLEXADIR)/www/gifs $(INSTALLROOT)$(INSTALLEXADIR)/www/help $(INSTALLROOT)$(INSTALLEXADIR)/www/menu 
 endif
 
 	mkdir -p $(INSTALLROOT)$(BBVAR)/acks
@@ -266,25 +280,25 @@ ifndef PKGBUILD
 endif
 
 install-common: install-dirs
-	BBHOME="$(BBHOME)" MANROOT="$(MANROOT)" INSTALLROOT="$(INSTALLROOT)" INSTALLBINDIR="$(INSTALLBINDIR)" INSTALLETCDIR="$(INSTALLETCDIR)" INSTALLEXTDIR="$(INSTALLEXTDIR)" INSTALLTMPDIR="$(INSTALLTMPDIR)" INSTALLWEBDIR="$(INSTALLWEBDIR)" INSTALLWWWDIR="$(INSTALLWWWDIR)" $(MAKE) -C common install
+	BBHOME="$(BBHOME)" MANROOT="$(MANROOT)" INSTALLROOT="$(INSTALLROOT)" INSTALLBINDIR="$(INSTALLBINDIR)" INSTALLETCDIR="$(INSTALLEXADIR)" INSTALLEXTDIR="$(INSTALLEXTDIR)" INSTALLTMPDIR="$(INSTALLTMPDIR)" INSTALLWEBDIR="$(INSTALLWEBDIR)" INSTALLWWWDIR="$(INSTALLWWWDIR)" $(MAKE) -C common install
 
 install-bbdisplay: install-common
-	BBHOME="$(BBHOME)" MANROOT="$(MANROOT)" CGIDIR="$(CGIDIR)" SECURECGIDIR="$(SECURECGIDIR)" INSTALLROOT="$(INSTALLROOT)" INSTALLBINDIR="$(INSTALLBINDIR)" INSTALLETCDIR="$(INSTALLETCDIR)" INSTALLEXTDIR="$(INSTALLEXTDIR)" INSTALLTMPDIR="$(INSTALLTMPDIR)" INSTALLWEBDIR="$(INSTALLWEBDIR)" INSTALLWWWDIR="$(INSTALLWWWDIR)" $(MAKE) -C bbdisplay install
+	BBHOME="$(BBHOME)" MANROOT="$(MANROOT)" CGIDIR="$(CGIDIR)" SECURECGIDIR="$(SECURECGIDIR)" INSTALLROOT="$(INSTALLROOT)" INSTALLBINDIR="$(INSTALLBINDIR)" INSTALLETCDIR="$(INSTALLEXADIR)" INSTALLEXTDIR="$(INSTALLEXTDIR)" INSTALLTMPDIR="$(INSTALLTMPDIR)" INSTALLWEBDIR="$(INSTALLWEBDIR)" INSTALLWWWDIR="$(INSTALLWWWDIR)" $(MAKE) -C bbdisplay install
 
 install-bbdisplay-nocgi: install-common
-	BBHOME="$(BBHOME)" MANROOT="$(MANROOT)" CGIDIR="$(CGIDIR)" SECURECGIDIR="$(SECURECGIDIR)" INSTALLROOT="$(INSTALLROOT)" INSTALLBINDIR="$(INSTALLBINDIR)" INSTALLETCDIR="$(INSTALLETCDIR)" INSTALLEXTDIR="$(INSTALLEXTDIR)" INSTALLTMPDIR="$(INSTALLTMPDIR)" INSTALLWEBDIR="$(INSTALLWEBDIR)" INSTALLWWWDIR="$(INSTALLWWWDIR)" $(MAKE) -C bbdisplay install-nocgi
+	BBHOME="$(BBHOME)" MANROOT="$(MANROOT)" CGIDIR="$(CGIDIR)" SECURECGIDIR="$(SECURECGIDIR)" INSTALLROOT="$(INSTALLROOT)" INSTALLBINDIR="$(INSTALLBINDIR)" INSTALLETCDIR="$(INSTALLEXADIR)" INSTALLEXTDIR="$(INSTALLEXTDIR)" INSTALLTMPDIR="$(INSTALLTMPDIR)" INSTALLWEBDIR="$(INSTALLWEBDIR)" INSTALLWWWDIR="$(INSTALLWWWDIR)" $(MAKE) -C bbdisplay install-nocgi
 
 install-bbnet: install-common
-	BBHOME="$(BBHOME)" MANROOT="$(MANROOT)" ARESVER="$(ARESVER)" INSTALLROOT="$(INSTALLROOT)" INSTALLBINDIR="$(INSTALLBINDIR)" INSTALLETCDIR="$(INSTALLETCDIR)" INSTALLEXTDIR="$(INSTALLEXTDIR)" INSTALLTMPDIR="$(INSTALLTMPDIR)" INSTALLWEBDIR="$(INSTALLWEBDIR)" INSTALLWWWDIR="$(INSTALLWWWDIR)" PKGBUILD="$(PKGBUILD)" $(MAKE) -C bbnet install
+	BBHOME="$(BBHOME)" MANROOT="$(MANROOT)" ARESVER="$(ARESVER)" INSTALLROOT="$(INSTALLROOT)" INSTALLBINDIR="$(INSTALLBINDIR)" INSTALLETCDIR="$(INSTALLEXADIR)" INSTALLEXTDIR="$(INSTALLEXTDIR)" INSTALLTMPDIR="$(INSTALLTMPDIR)" INSTALLWEBDIR="$(INSTALLWEBDIR)" INSTALLWWWDIR="$(INSTALLWWWDIR)" PKGBUILD="$(PKGBUILD)" $(MAKE) -C bbnet install
 
 install-bbproxy: install-common
-	BBHOME="$(BBHOME)" MANROOT="$(MANROOT)" INSTALLROOT="$(INSTALLROOT)" INSTALLBINDIR="$(INSTALLBINDIR)" INSTALLETCDIR="$(INSTALLETCDIR)" INSTALLEXTDIR="$(INSTALLEXTDIR)" INSTALLTMPDIR="$(INSTALLTMPDIR)" INSTALLWEBDIR="$(INSTALLWEBDIR)" INSTALLWWWDIR="$(INSTALLWWWDIR)" $(MAKE) -C bbproxy install
+	BBHOME="$(BBHOME)" MANROOT="$(MANROOT)" INSTALLROOT="$(INSTALLROOT)" INSTALLBINDIR="$(INSTALLBINDIR)" INSTALLETCDIR="$(INSTALLEXADIR)" INSTALLEXTDIR="$(INSTALLEXTDIR)" INSTALLTMPDIR="$(INSTALLTMPDIR)" INSTALLWEBDIR="$(INSTALLWEBDIR)" INSTALLWWWDIR="$(INSTALLWWWDIR)" $(MAKE) -C bbproxy install
 
 install-hobbitd: install-common
-	MANROOT="$(MANROOT)" BBTOPDIR="$(BBTOPDIR)" BBHOME="$(BBHOME)" BBVAR="$(BBVAR)" CGIDIR="$(CGIDIR)" SECURECGIDIR="$(SECURECGIDIR)" BBLOGDIR="$(BBLOGDIR)" BBUSER="$(BBUSER)" INSTALLROOT="$(INSTALLROOT)" INSTALLBINDIR="$(INSTALLBINDIR)" INSTALLETCDIR="$(INSTALLETCDIR)" INSTALLEXTDIR="$(INSTALLEXTDIR)" INSTALLTMPDIR="$(INSTALLTMPDIR)" INSTALLWEBDIR="$(INSTALLWEBDIR)" INSTALLWWWDIR="$(INSTALLWWWDIR)" HTTPDGID="$(HTTPDGID)" $(MAKE) -C hobbitd install
+	MANROOT="$(MANROOT)" BBTOPDIR="$(BBTOPDIR)" BBHOME="$(BBHOME)" BBVAR="$(BBVAR)" CGIDIR="$(CGIDIR)" SECURECGIDIR="$(SECURECGIDIR)" BBLOGDIR="$(BBLOGDIR)" BBUSER="$(BBUSER)" INSTALLROOT="$(INSTALLROOT)" INSTALLBINDIR="$(INSTALLBINDIR)" INSTALLETCDIR="$(INSTALLEXADIR)" INSTALLEXTDIR="$(INSTALLEXTDIR)" INSTALLTMPDIR="$(INSTALLTMPDIR)" INSTALLWEBDIR="$(INSTALLWEBDIR)" INSTALLWWWDIR="$(INSTALLEXADIR)/www" HTTPDGID="$(HTTPDGID)" PKGBUILD="$(PKGBUILD)" $(MAKE) -C hobbitd install
 
 install-web: install-common
-	MANROOT="$(MANROOT)" BBTOPDIR="$(BBTOPDIR)" BBHOME="$(BBHOME)" BBVAR="$(BBVAR)" CGIDIR="$(CGIDIR)" SECURECGIDIR="$(SECURECGIDIR)" BBLOGDIR="$(BBLOGDIR)" BBUSER="$(BBUSER)" INSTALLROOT="$(INSTALLROOT)" INSTALLBINDIR="$(INSTALLBINDIR)" INSTALLETCDIR="$(INSTALLETCDIR)" INSTALLEXTDIR="$(INSTALLEXTDIR)" INSTALLTMPDIR="$(INSTALLTMPDIR)" INSTALLWEBDIR="$(INSTALLWEBDIR)" INSTALLWWWDIR="$(INSTALLWWWDIR)" $(MAKE) -C web install
+	MANROOT="$(MANROOT)" BBTOPDIR="$(BBTOPDIR)" BBHOME="$(BBHOME)" BBVAR="$(BBVAR)" CGIDIR="$(CGIDIR)" SECURECGIDIR="$(SECURECGIDIR)" BBLOGDIR="$(BBLOGDIR)" BBUSER="$(BBUSER)" INSTALLROOT="$(INSTALLROOT)" INSTALLBINDIR="$(INSTALLBINDIR)" INSTALLETCDIR="$(INSTALLEXADIR)" INSTALLEXTDIR="$(INSTALLEXTDIR)" INSTALLTMPDIR="$(INSTALLTMPDIR)" INSTALLWEBDIR="$(INSTALLWEBDIR)" INSTALLWWWDIR="$(INSTALLWWWDIR)" $(MAKE) -C web install
 
 
 # NOTE: This one is normally not used - man-page install is done by the sub-Makefiles during "make install"
@@ -297,10 +311,10 @@ install-man:
 	BBHOME="$(BBHOME)" MANROOT="$(MANROOT)" INSTALLROOT="$(INSTALLROOT)" $(MAKE) -C web install-man
 
 install-docs:
-	BBHOME="$(BBHOME)" MANROOT="$(MANROOT)" INSTALLROOT="$(INSTALLROOT)" INSTALLBINDIR="$(INSTALLBINDIR)" INSTALLETCDIR="$(INSTALLETCDIR)" INSTALLEXTDIR="$(INSTALLEXTDIR)" INSTALLTMPDIR="$(INSTALLTMPDIR)" INSTALLWEBDIR="$(INSTALLWEBDIR)" INSTALLWWWDIR="$(INSTALLWWWDIR)" $(MAKE) -C docs install
+	BBHOME="$(BBHOME)" MANROOT="$(MANROOT)" INSTALLROOT="$(INSTALLROOT)" INSTALLBINDIR="$(INSTALLBINDIR)" INSTALLETCDIR="$(INSTALLEXADIR)" INSTALLEXTDIR="$(INSTALLEXTDIR)" INSTALLTMPDIR="$(INSTALLTMPDIR)" INSTALLWEBDIR="$(INSTALLWEBDIR)" INSTALLWWWDIR="$(INSTALLEXADIR)/www" $(MAKE) -C docs install
 
 install-custom:
-	BBHOME="$(BBHOME)" MANROOT="$(MANROOT)" INSTALLROOT="$(INSTALLROOT)" INSTALLBINDIR="$(INSTALLBINDIR)" INSTALLETCDIR="$(INSTALLETCDIR)" INSTALLEXTDIR="$(INSTALLEXTDIR)" INSTALLTMPDIR="$(INSTALLTMPDIR)" INSTALLWEBDIR="$(INSTALLWEBDIR)" INSTALLWWWDIR="$(INSTALLWWWDIR)" $(MAKE) -C custom install || echo "Skipped custom modules"
+	BBHOME="$(BBHOME)" MANROOT="$(MANROOT)" INSTALLROOT="$(INSTALLROOT)" INSTALLBINDIR="$(INSTALLBINDIR)" INSTALLETCDIR="$(INSTALLEXADIR)" INSTALLEXTDIR="$(INSTALLEXTDIR)" INSTALLTMPDIR="$(INSTALLTMPDIR)" INSTALLWEBDIR="$(INSTALLWEBDIR)" INSTALLWWWDIR="$(INSTALLWWWDIR)" $(MAKE) -C custom install || echo "Skipped custom modules"
 
 
 client-install: install-client
