$NetBSD: patch-aa,v 1.1.1.1 2002/08/23 03:12:26 grant Exp $

--- Makefile.orig	Wed Dec 19 20:19:56 2001
+++ Makefile
@@ -6,12 +6,9 @@
 
 # Configuration defaults
 
-CC       = gcc
-CFLAGS   = -O2 -Wall
-INCLUDES = -I/usr/X11R6/include -I$(shell pwd)
-LDLIBS   = -L/usr/X11R6/lib -lX11
+INCLUDES = -I$(X11BASE)/include -I$(shell pwd)
+LDLIBS   = -lX11
 
-PREFIX   = /usr/local
 EPREFIX  = $(PREFIX)
 BINDIR   = $(EPREFIX)/bin
 MANDIR   = $(PREFIX)/man
@@ -24,6 +21,7 @@ GNUOBJ   = gnu/getopt.o gnu/getopt1.o
 OS = $(shell uname -s)
 MACH = $(shell uname -m)
 
+LDLIBS+=	$(LDFLAGS)
 
 # add architecture specific stuff here.
 ifeq "$(MACH)" "ppc"
@@ -35,7 +33,7 @@ ifeq "$(OS)" "UnixWare"
 LDLIBS += -l socket
 endif
 ifeq "$(OS)" "SunOS"
-LDLIBS += -lsocket -lnsl -R$(X11DIR)/lib
+LDLIBS += -lsocket -lnsl
 endif
 ifeq "$(OS)" "OSF1"
 LDLIBS += -Wl,-rpath,$(X11DIR)/lib
@@ -79,25 +77,22 @@ localendian.h: endian
 endian: tests/endian.c
 	$(CC) -o tests/endian tests/endian.c
 
-rdesktop: $(RDPOBJ) $(CRYPTOBJ)
-	$(CC) $(CFLAGS) -o rdesktop $(RDPOBJ) $(CRYPTOBJ) $(LDDIRS) $(LDLIBS) ${GNUOBJ}
+rdesktop: $(RDPOBJ) $(CRYPTOBJ) $(GNUOBJ)
+	$(CC) $(CFLAGS) -o rdesktop $(LDDIRS) $(LDLIBS) $(RDPOBJ) $(CRYPTOBJ) $(GNUOBJ)
 
-rdp-srvr: $(GNUOBJ) $(RDPSOBJ)
-	$(CC) $(CFLAGS) -o rdp-srvr $(RDPSOBJ) $(CRYPTOBJ) $(LDDIRS) $(LDLIBS) ${GNUOBJ}
+rdp-srvr: $(GNUOBJ) $(RDPSOBJ) $(GNUOBJ)
+	$(CC) $(CFLAGS) -o rdp-srvr $(LDDIRS) $(LDLIBS) $(RDPSOBJ) $(CRYPTOBJ) $(GNUOBJ)
 
 Makeconf:
 	./configure
 
-install: installbin
+install: installbin installman
 
-installbin: rdesktop rdp-srvr
+installbin: rdesktop
 	mkdir -p $(BINDIR)
 	cp rdesktop $(BINDIR)
-	cp rdp-srvr $(BINDIR)
 	strip $(BINDIR)/rdesktop
-	strip $(BINDIR)/rdp-srvr
 	chmod 755 $(BINDIR)/rdesktop
-	chmod 755 $(BINDIR)/rdp-srvr
 
 installman: rdesktop.1
 	mkdir -p $(MANDIR)/man1
@@ -130,6 +125,12 @@ tcp-s.o: tcp.c
 
 xwin-s.o: xwin.c keymap_wrap.c keymap.c
 	$(CC) $(CFLAGS) -DSERVER -o $@ -c $<
+
+gnu/getopt.o: gnu/getopt.c
+	$(CC) -o $@ -c $<
+
+gnu/getopt1.o: gnu/getopt1.c
+	$(CC) -o $@ -c $<
 
 .SUFFIXES:
 .SUFFIXES: .c .o
