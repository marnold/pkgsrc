$NetBSD: patch-bl,v 1.1.1.1 1999/10/08 04:34:43 dbj Exp $

--- pppd/ipcp.c.orig	Fri Aug 13 02:46:12 1999
+++ pppd/ipcp.c	Sat Sep 25 13:48:29 1999
@@ -121,6 +121,8 @@
       "Don't use name for default IP adrs", 1 },
     { "ms-dns", 1, setdnsaddr,
       "DNS address for the peer's use" },
+    { "dns-addr", 1, setdnsaddr,
+      "DNS address for the peer's use" },
     { "ms-wins", 1, setwinsaddr,
       "Nameserver for SMB over TCP/IP for peer" },
     { "ipcp-restart", o_int, &ipcp_fsm[0].timeouttime,
@@ -1057,6 +1059,14 @@
 	     */
 	    GETLONG(tl, p);		/* Parse source address (his) */
 	    ciaddr1 = htonl(tl);
+#ifdef DYNAMIC
+	    if(!auth_ip_addr(f->unit, ciaddr1))
+		if(get_ip_addr_dynamic(f->unit, &tl))
+		{
+		    wo->hisaddr = tl;
+		    ciaddr1 = 0;
+		}
+#endif
 	    if (ciaddr1 != wo->hisaddr
 		&& (ciaddr1 == 0 || !wo->accept_remote)) {
 		orc = CONFNAK;
@@ -1114,6 +1124,14 @@
 	     */
 	    GETLONG(tl, p);	/* Parse source address (his) */
 	    ciaddr1 = htonl(tl);
+#ifdef DYNAMIC
+	    if(!auth_ip_addr(f->unit, ciaddr1))
+		if(get_ip_addr_dynamic(f->unit, &tl))
+		{
+		    wo->hisaddr = tl;
+		    ciaddr1 = 0;
+		}
+#endif
 	    if (ciaddr1 != wo->hisaddr
 		&& (ciaddr1 == 0 || !wo->accept_remote)) {
 		orc = CONFNAK;
