$NetBSD: patch-bc,v 1.1.2.2 2002/08/25 21:20:48 jlam Exp $

diff -u1 bgpd/bgp_packet.c /home/itojun/work/zebra/zebra/bgpd/bgp_packet.c
--- bgpd/bgp_packet.c	Sat Jun 29 15:20:39 2002
+++ /home/itojun/work/zebra/zebra/bgpd/bgp_packet.c	Sat Aug  3 21:05:49 2002
@@ -758,3 +758,5 @@
   /* Set capability code. */
-  bgp_open_capability (s, peer);
+  if (CHECK_FLAG (peer->sflags, PEER_STATUS_CAPABILITY_OPEN) &&
+      ! CHECK_FLAG (peer->flags, PEER_FLAG_DONT_CAPABILITY))
+    bgp_open_capability (s, peer);
 
