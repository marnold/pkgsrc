$NetBSD: patch-am,v 1.1.1.1 2000/07/31 17:36:02 abs Exp $

--- sys/netbsd/Makefile.orig	Thu Feb  4 07:30:30 1999
+++ sys/netbsd/Makefile	Mon Jul 31 14:07:25 2000
@@ -1,10 +1,10 @@
 # NetBSD specific defines, passed to subdirectories.
 DEFS=	-DBSD4_4
-OPTOPTS=	-O2
-CC=	gcc -I../../sys/netbsd/ -I/usr/include/kerberosIV
+OPTOPTS=	-Werror -I../../sys/netbsd/
+#CC=	gcc -I../../sys/netbsd/ -I/usr/include/kerberosIV
 INSTALL=	install
 AFPLIBS = 	-lcrypt -lrpcsvc
-ADDLIBS =
+ADDLIBS=	-Wl,-R${LIBDIR}
 
 ALL=	../../libatalk ../../include ../../bin ../../etc ../../man
 
@@ -19,6 +19,7 @@
 ${ALL}:	FRC
 	cd $@; ${MAKE} ${MFLAGS} CC="${CC}" \
 	    ADDLIBS="${ADDLIBS}" DEFS="${DEFS}" OPTOPTS="${OPTOPTS}" \
+	    LIBEXECDIR="${LIBEXECDIR}" EXAMPLEDIR="${EXAMPLEDIR}" \
 	    SBINDIR="${SBINDIR}" BINDIR="${BINDIR}" RESDIR="${RESDIR}" \
 	    ETCDIR="${ETCDIR}" LIBDIR="${LIBDIR}" INCDIR="${INCDIR}" \
 	    AFPLIBS="${AFPLIBS}" \
@@ -28,30 +29,34 @@
 
 install :
 	-mkdir ${DESTDIR} ${SBINDIR} ${BINDIR} ${ETCDIR} ${LIBDIR}
+	-mkdir ${LIBEXECDIR} ${EXAMPLEDIR} ${RCDIR}
 	for i in ${ALL}; \
 	    do (cd $$i; ${MAKE} ${MFLAGS} CC="${CC}" \
 		ADDLIBS="${ADDLIBS}" DEFS="${DEFS}" OPTOPTS="${OPTOPTS}" \
+		LIBEXECDIR="${LIBEXECDIR}" EXAMPLEDIR="${EXAMPLEDIR}" \
 	        SBINDIR="${SBINDIR}" BINDIR="${BINDIR}" RESDIR="${RESDIR}" \
 	        ETCDIR="${ETCDIR}" LIBDIR="${LIBDIR}" INCDIR="${INCDIR}" \
 		AFSDIR="${AFSDIR}" KRBDIR="${KRBDIR}" AFPLIBS="${AFPLIBS}" \
 		INSTALL="${INSTALL}" $@); \
 	done
-	rm -f ${ETCDIR}/rc.atalk
+	for i in `ls ../../config`; \
+		do ${INSTALL} -c ../../config/$$i ${EXAMPLEDIR}; \
+	done
+	rm -f ${RCDIR}/netatalk.sh
 	sed -e s@:DESTDIR:@${DESTDIR}@ -e s@:SBINDIR:@${SBINDIR}@ \
 		-e s@:BINDIR:@${BINDIR}@ -e s@:RESDIR:@${RESDIR}@ \
 		-e s@:ETCDIR:@${ETCDIR}@ -e s@:LIBDIR:@${LIBDIR}@ \
 		-e s@:INCDIR:@${INCDIR}@ \
-	    < ../../rc.atalk.bsd > ${ETCDIR}/rc.atalk
+		-e s@:LIBEXECDIR:@${LIBEXECDIR}@ \
+		-e s@:EXAMPLEDIR:@${EXAMPLEDIR}@ \
+	    < ../../rc.atalk.bsd > ${RCDIR}/netatalk.sh
+	chmod 755 ${RCDIR}/netatalk.sh
+	@echo "Install is done."
 	@echo
-	@echo "Install is done.  You might need to add services from"
-	@echo "services.atalk to /etc/services. The ddp services need to be"
-	@echo "added for NetBSD versions earlier than 1.3, and the AFP over"
-	@echo "TCP services need to be added for NetBSD 1.3.X, and for"
-	@echo "1.3-current dated June 27, 1998 and earlier."
+	@echo "Example configuration files are in ${EXAMPLEDIR}."
 	@echo
-	@echo "Don't forget to call rc.atalk in /etc/rc.local.  See README"
-	@echo "and README.NETBSD for more information."
-
+	@echo "Don't forget to call ${RCDIR}/netatalk.sh in /etc/rc.local."
+	@echo "See README.NETBSD for kernel configuration information."
 clean :
 	for i in ${ALL}; \
 	    do (cd $$i; ${MAKE} ${MFLAGS} clean); \
