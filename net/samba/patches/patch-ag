$NetBSD: patch-ag,v 1.5.10.1 2007/02/15 13:14:48 salo Exp $

--- passdb/passdb.c.orig	2007-02-04 18:59:21.000000000 +0000
+++ passdb/passdb.c	2007-02-11 15:29:46.000000000 +0000
@@ -137,6 +137,7 @@
 	const char *guest_account = lp_guestaccount();
 	const char *domain = global_myname();
 	uint32 urid;
+	char *gecos;
 
 	if ( !pwd ) {
 		return NT_STATUS_NO_SUCH_USER;
@@ -145,7 +146,9 @@
 	/* Basic properties based upon the Unix account information */
 	
 	pdb_set_username(user, pwd->pw_name, PDB_SET);
-	pdb_set_fullname(user, pwd->pw_gecos, PDB_SET);
+	gecos = passwd_expand_gecos(pwd);
+	pdb_set_fullname(user, gecos, PDB_SET);
+	SAFE_FREE(gecos);
 	pdb_set_domain (user, get_global_sam_name(), PDB_DEFAULT);
 #if 0
 	/* This can lead to a primary group of S-1-22-2-XX which 
