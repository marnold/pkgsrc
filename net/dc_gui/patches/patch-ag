$NetBSD: patch-ag,v 1.1.1.1 2002/09/11 20:47:14 wiz Exp $

--- src/main.c.orig	Fri Aug 23 18:41:11 2002
+++ src/main.c
@@ -8,7 +8,7 @@
 #endif
 
 #include <signal.h>
-#include <db.h>
+#include <db4/db.h>
 #include <errno.h>
 #include <sys/stat.h>
 #include <sys/types.h>
@@ -329,6 +329,23 @@ main (int argc, char *argv[])
 
 	dctc_dir=g_string_new(NULL);
 	g_string_sprintf(dctc_dir,"%s/running",dctc_main_dir->str);
+	if(access(dctc_dir->str,R_OK|W_OK|X_OK))
+	{
+		if(errno==ENOENT)
+		{
+			if(mkdir(dctc_dir->str,0777))
+			{
+				perror("mkdir");
+				fprintf(stderr,"Unable to create %s, abort.\n",dctc_dir->str);
+				exit(1);
+			}
+		}
+		else
+		{
+			fprintf(stderr,"You have no access rights on %s, abort.\n",dctc_dir->str);
+			exit(1);
+		}
+	}
 	dctc_active_client_file=g_string_new(NULL);
 	g_string_sprintf(dctc_active_client_file,"%s/gstatus",dctc_main_dir->str);
 
