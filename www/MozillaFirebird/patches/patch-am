$NetBSD: patch-am,v 1.1.1.1 2003/08/16 14:19:36 taya Exp $

diff -ru ../Orig/mozilla/nsprpub/pr/src/pthreads/ptio.c ./nsprpub/pr/src/pthreads/ptio.c
--- ../Orig/mozilla/nsprpub/pr/src/pthreads/ptio.c	2003-07-09 12:37:46.000000000 +0900
+++ ./nsprpub/pr/src/pthreads/ptio.c	2003-07-31 23:23:12.000000000 +0900
@@ -194,7 +194,7 @@
 #elif defined(IRIX) || defined(OSF1) || defined(AIX) || defined(HPUX) \
     || defined(LINUX) || defined(FREEBSD) || defined(BSDI) || defined(VMS) \
     || defined(NTO) || defined(OPENBSD) || defined(DARWIN) \
-    || defined(UNIXWARE)
+    || defined(UNIXWARE) || defined(NETBSD)
 #define _PRSockOptVal_t void *
 #else
 #error "Cannot determine architecture"
@@ -3370,7 +3370,7 @@
 PR_EXTERN(PRStatus) _pr_push_ipv6toipv4_layer(PRFileDesc *fd);
 #if defined(_PR_INET6_PROBE)
 PR_EXTERN(PRBool) _pr_ipv6_is_present;
-#ifdef DARWIN
+#if defined(DARWIN) || (defined(__NetBSD__) && defined(IPV6_V6ONLY))
 static PRBool _pr_ipv6_v6only_on_by_default;
 #endif
 PR_IMPLEMENT(PRBool) _pr_test_ipv6_socket()
@@ -3385,7 +3385,7 @@
      */
     osfd = socket(AF_INET6, SOCK_STREAM, 0);
     if (osfd != -1) {
-#ifdef DARWIN
+#if defined(DARWIN) || (defined(__NetBSD__) && defined(IPV6_V6ONLY))
         /* In Mac OS X v10.3 Panther Beta the IPV6_V6ONLY socket option
          * is turned on by default, contrary to what RFC 3493, Section
          * 5.3 says.  So we have to turn it off.  Find out whether we
@@ -3452,7 +3452,7 @@
     if (osfd == -1) pt_MapError(_PR_MD_MAP_SOCKET_ERROR, errno);
     else
     {
-#ifdef DARWIN
+#if defined(DARWIN) || (defined(__NetBSD__) && defined(IPV6_V6ONLY))
         if ((domain == AF_INET6) && _pr_ipv6_v6only_on_by_default)
         {
             int on = 0;
