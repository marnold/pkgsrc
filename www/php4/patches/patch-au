$NetBSD: patch-au,v 1.1.2.2 2006/07/23 15:32:41 salo Exp $

# This is CVE-2006-1990

--- ext/standard/string.c.orig	2006-01-01 13:46:58.000000000 +0000
+++ ext/standard/string.c
@@ -672,15 +672,13 @@ PHP_FUNCTION(wordwrap)
 		/* Multiple character line break or forced cut */
 		if (linelength > 0) {
 			chk = (int)(textlen/linelength + 1);
+			newtext = safe_emalloc(chk, breakcharlen, textlen + 1);
 			alloced = textlen + chk * breakcharlen + 1;
 		} else {
 			chk = textlen;
+			newtext = safe_emalloc(textlen, (breakcharlen + 1), 1);
 			alloced = textlen * (breakcharlen + 1) + 1;
 		}
-		if (alloced <= 0) {
-			RETURN_FALSE;
-		}
-		newtext = emalloc(alloced);
 
 		/* now keep track of the actual new text length */
 		newtextlen = 0;
