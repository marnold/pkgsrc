$NetBSD: patch-ab,v 1.1.1.1 2003/04/25 04:39:55 rh Exp $

--- tools/gst-launch.c.orig	2003-02-02 10:05:42.000000000 +1000
+++ tools/gst-launch.c
@@ -1,7 +1,9 @@
+#include <errno.h>
 #include <string.h>
 #include <stdlib.h>
 #include <signal.h>
 #include <sys/wait.h>
+#include <sys/signal.h>
 #include <gst/gst.h>
 
 static guint64 iterations = 0;
@@ -158,6 +160,19 @@ fault_handler (int signum, siginfo_t *si
 
 }
 
+#ifndef SA_SIGINFO
+void si_handler(int sig, int code, struct sigcontext *scp)
+{
+	siginfo_t si;
+
+	si.si_signo = sig;
+	si.si_errno = errno;
+	si.si_code = code;
+
+	fault_handler(sig, &si, scp);
+}
+#endif
+
 static void 
 fault_restore (void)
 {
@@ -176,8 +191,13 @@ fault_setup (void)
   struct sigaction action;
 
   memset (&action, 0, sizeof (action));
+#ifdef SA_SIGINFO
   action.sa_sigaction = fault_handler;
   action.sa_flags = SA_SIGINFO;
+#else
+  action.sa_sigaction = (void (*)(int))si_handler;
+  action.sa_flags = 0;
+#endif
 
   sigaction (SIGSEGV, &action, NULL);
   sigaction (SIGQUIT, &action, NULL);
