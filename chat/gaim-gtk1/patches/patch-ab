$NetBSD: patch-ab,v 1.1.1.1 2003/04/11 15:39:03 jmmv Exp $

--- src/perl.c.orig	Sat Dec 21 20:08:19 2002
+++ src/perl.c	Thu Jan  9 16:03:03 2003
@@ -178,15 +178,13 @@
 {
 	DIR *dir;
 	struct dirent *ent;
-	struct dirent *dirent_buf;
 	char *buf;
 	char *path;
 
 	path = gaim_user_dir();
 	dir = opendir(path);
 	if (dir) {
-		dirent_buf = g_malloc(sizeof(struct dirent) + NAME_MAX);
-		while ((readdir_r(dir,dirent_buf,&ent),ent)) {
+ 		while ((ent = readdir(dir))) {
 			if (strcmp(ent->d_name, ".") && strcmp(ent->d_name, "..")) {
 				if (is_pl_file(ent->d_name)) {
 					buf = g_malloc(strlen(path) + strlen(ent->d_name) + 2);
@@ -197,7 +195,6 @@
 			}
 		}
 		closedir(dir);
-		g_free(dirent_buf);
 	}
 	g_free(path);
 }
@@ -295,7 +292,7 @@
 XS (XS_GAIM_register)
 {
 	char *name, *ver, *callback, *unused; /* exactly like X-Chat, eh? :) */
-	unsigned int junk;
+	STRLEN junk;
 	struct perlscript *scp;
 	dXSARGS;
 	items = 0;
@@ -406,7 +403,7 @@
 {
 	char *title;
 	char *message;
-	unsigned int junk;
+	STRLEN junk;
 	dXSARGS;
 	items = 0;
 
@@ -474,7 +471,7 @@
 
 XS (XS_GAIM_command)
 {
-	unsigned int junk;
+	STRLEN junk;
 	char *command = NULL;
 	dXSARGS;
 	items = 0;
@@ -526,7 +523,7 @@
 XS (XS_GAIM_user_info)
 {
 	struct gaim_connection *gc;
-	unsigned int junk;
+	STRLEN junk;
 	struct buddy *buddy = NULL;
 	dXSARGS;
 	items = 0;
@@ -552,7 +549,7 @@
 {
 	char *nick, *who, *what;
 	struct conversation *c;
-	int junk;
+	STRLEN junk;
 	int send, wflags;
 	dXSARGS;
 	items = 0;
@@ -584,7 +581,7 @@
 	struct gaim_connection *gc;
 	char *nick, *what;
 	int isauto;
-	int junk;
+	STRLEN junk;
 	dXSARGS;
 	items = 0;
 
@@ -607,7 +604,7 @@
 	char *nick, *what;
 	int isauto;
 	struct conversation *c;
-	unsigned int junk;
+	STRLEN junk;
 	dXSARGS;
 	items = 0;
 
@@ -637,7 +634,7 @@
 	char *what;
 	struct conversation *b = NULL;
 	GSList *bcs;
-	unsigned int junk;
+	STRLEN junk;
 	dXSARGS;
 	items = 0;
 
@@ -803,7 +800,7 @@
 
 XS (XS_GAIM_add_event_handler)
 {
-	unsigned int junk;
+	STRLEN junk;
 	struct _perl_event_handlers *handler;
 	dXSARGS;
 	items = 0;
@@ -830,7 +827,7 @@
 
 XS (XS_GAIM_add_timeout_handler)
 {
-	unsigned int junk;
+	STRLEN junk;
 	long timeout;
 	struct _perl_timeout_handlers *handler;
 	dXSARGS;
