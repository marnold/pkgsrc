$NetBSD: patch-aj,v 1.1.1.1 1999/12/04 12:56:31 scw Exp $

--- libaudiofile/macros.c.orig	Wed Nov 25 21:11:54 1998
+++ libaudiofile/macros.c	Tue Nov 30 22:20:48 1999
@@ -55,6 +55,7 @@
   return bigEndian;
 }
 
+#ifndef USE_STDIO
 /*---------------------------------------------------------------------------
 | FUNCTION uiRead
 ---------------------------------------------------------------------------*/
@@ -381,8 +382,7 @@
   return count;
 }
 
-
-
+#endif
 
 
 
@@ -406,7 +406,7 @@
     *ui = swapbytes_uint (*ui);
   #endif
   
-  return 1;
+  return sizeof(*ui);
 }
 
 /*---------------------------------------------------------------------------
@@ -424,7 +424,7 @@
     *i = swapbytes_int (*i);
   #endif
   
-  return 1;
+  return sizeof(*i);
 }
 
 /*---------------------------------------------------------------------------
@@ -442,7 +442,7 @@
     *us = swapbytes_ushort (*us);
   #endif
   
-  return 1;
+  return sizeof(*us);
 }
 
 /*---------------------------------------------------------------------------
@@ -460,7 +460,7 @@
     *s = swapbytes_short (*s);
   #endif
   
-  return 1;
+  return sizeof(*s);
 }
 
 /*---------------------------------------------------------------------------
@@ -487,7 +487,7 @@
 int fReadF (FILE *file,float *f)
 {
   if (fread (f,sizeof(*f),1,file) != 1) return 0;
-  return 1;
+  return sizeof(*f);
 }
 
 /*---------------------------------------------------------------------------
@@ -496,7 +496,7 @@
 int dReadF (FILE *file,double *d)
 {
   if (fread (d,sizeof(*d),1,file) != 1) return 0;
-  return 1;
+  return sizeof(*d);
 }
 
 /*---------------------------------------------------------------------------
@@ -507,7 +507,7 @@
   unsigned char etemp [10];
   if (fread (etemp,10,1,file) != 1) return 0;
   *f = (float) convertFromIeeeExtended (etemp);
-  return 1;
+  return sizeof(*f);
 }
 
 /*---------------------------------------------------------------------------
@@ -518,7 +518,7 @@
   unsigned char etemp [10];
   if (fread (etemp,10,1,file) != 1) return 0;
   *d = convertFromIeeeExtended (etemp);
-  return 1;
+  return sizeof(*d);
 }
 
 /*---------------------------------------------------------------------------
@@ -527,7 +527,7 @@
 int idReadF (FILE *file,char *c)
 {
   if (fread (c,4,1,file) != 1) return 0;
-  return 1;
+  return 4;
 }
 
 /*---------------------------------------------------------------------------
@@ -551,7 +551,7 @@
     if (!ucReadF (file,&temp)) return 0;
     count++;
   }
-  return 1;
+  return count;
 }
 
 /*---------------------------------------------------------------------------
@@ -569,7 +569,7 @@
   
   if (fwrite (&ui,sizeof(ui),1,file) != 1) return 0;
   
-  return 1;
+  return sizeof(ui);
 }
 
 /*---------------------------------------------------------------------------
@@ -587,7 +587,7 @@
 
   if (fwrite (&i,sizeof(i),1,file) != 1) return 0;
   
-  return 1;
+  return sizeof(i);
 }
 
 /*---------------------------------------------------------------------------
@@ -605,7 +605,7 @@
   
   if (fwrite (&us,sizeof(us),1,file) != 1) return 0;
   
-  return 1;
+  return sizeof(us);
 }
 
 /*---------------------------------------------------------------------------
@@ -623,7 +623,7 @@
   
   if (fwrite (&s,sizeof(s),1,file) != 1) return 0;
   
-  return 1;
+  return sizeof(s);
 }
 
 /*---------------------------------------------------------------------------
@@ -650,7 +650,7 @@
 int fWriteF (FILE *file,float f)
 {
   if (fwrite (&f,sizeof(f),1,file) != 1) return 0;
-  return 1;
+  return sizeof(f);
 }
 
 /*---------------------------------------------------------------------------
@@ -659,7 +659,7 @@
 int dWriteF (FILE *file,double d)
 {
   if (fwrite (&d,sizeof(d),1,file) != 1) return 0;
-  return 1;
+  return sizeof(d);
 }
 
 /*---------------------------------------------------------------------------
@@ -670,7 +670,7 @@
   unsigned char etemp [10];
   convertToIeeeExtended ((double) f,etemp);
   if (fwrite (etemp,10,1,file) != 1) return 0;
-  return 1;
+  return sizeof(f);
 }
 
 /*---------------------------------------------------------------------------
@@ -681,7 +681,7 @@
   unsigned char etemp [10];
   convertToIeeeExtended (d,etemp);
   if (fwrite (etemp,10,1,file) != 1) return 0;
-  return 1;
+  return sizeof(d);
 }
 
 /*---------------------------------------------------------------------------
@@ -690,7 +690,7 @@
 int idWriteF (FILE *file,char *c)
 {
   if (fwrite (c,4,1,file) != 1) return 0;
-  return 1;
+  return 4;
 }
 
 /*---------------------------------------------------------------------------
@@ -714,8 +714,9 @@
     if (!(ucWriteF (file,temp))) return 0;
     count++;
   }
-  return 1;
+  return count;
 }
+
 
 /*---------------------------------------------------------------------------
 | FUNCTION swapbytes_type functions
