$NetBSD: patch-ac,v 1.1.1.1 2003/04/15 10:26:35 wiz Exp $

--- pan/pan.c.orig	Mon Jul 15 04:04:34 2002
+++ pan/pan.c
@@ -43,6 +43,27 @@
 #include <pan/thread-watch.h>
 #include <pan/util.h>
 
+#ifdef __NetBSD__
+#include <pthread.h>
+
+#ifdef _PTH_PTHREAD_H_
+#include <gtk/gtk.h>
+
+/*
+ * Pth is non-preemptive, so we yield the processor periodically
+ */
+
+gint
+pth_nbschedule (gpointer data)
+{
+	pthread_yield_np();
+
+	return TRUE;
+}
+#endif
+#endif
+
+
 static gint save_session (GnomeClient        * client,
 			  gint                 phase,
 			  GnomeSaveStyle       save_style,
@@ -197,6 +218,10 @@ main (int argc, char *argv[])
 				newsrc_import (s, newsrc_filename, newsrc_port_subscribed_only);
 		}
 	}
+
+#ifdef _PTH_PTHREAD_H_
+	gtk_timeout_add (200, pth_nbschedule, NULL);
+#endif
 
 	gtk_main ();
 
