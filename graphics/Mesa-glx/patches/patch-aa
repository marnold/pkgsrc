$NetBSD: patch-aa,v 1.1.1.1 1999/09/29 22:44:17 tron Exp $

--- libGL/Makefile.in.orig	Sun Jul  4 23:58:47 1999
+++ libGL/Makefile.in	Wed Sep 29 19:06:23 1999
@@ -7,7 +7,7 @@
 # These define the name/version of the shared library we're building
 # ------------------------------------------------------------------
 LIBNAME = GL
-SOGLREV = 1.0
+SOGLREV = 3:0
 
 # Source and Object files
 # -----------------------
@@ -16,7 +16,6 @@
 	map_points.c pointers.c glx_varray.c
 
 OBJS = ${SRCS:.c=.o}
-UNSHARED_OBJS = unshared/*.o
 
 
 # Additional compiler rules
@@ -34,22 +33,12 @@
 	${CC} ${ALL_CFLAGS} -E $*.c > $@
 
 .c.o:
-ifeq "${USE_DYNAMIC_MODULE}" "yes"
-	${RM} $@
-	${CC} ${ALL_CFLAGS} ${SHARED_CFLAGS} -c $<
-else
-	${RM} unshared/$@
-	${CC} ${ALL_CFLAGS} -c $< -o unshared/$@
-endif
+	${LIBTOOL} ${CC} ${ALL_CFLAGS} -c $< 
 
 # Main targets
 # ------------
 
-ifeq "${USE_DYNAMIC_MODULE}" "yes"
-all : lib${LIBNAME}.so.${SOGLREV}
-else
-all : unshared-subdir lib${LIBNAME}.a
-endif
+all : lib${LIBNAME}.la
 
 clean :
 	${RM} *.CKP *.ln *.BAK *.bak *.o core errs ,* *~ *.a .emacs_* tags TAGS make.log MakeOut  "#"*
@@ -61,20 +50,8 @@
 	${DEPEND} -f .deps -- ${ALL_CFLAGS} -- ${SRCS}
 
 
-ifeq "${USE_DYNAMIC_MODULE}" "yes"
-install: lib${LIBNAME}.so.${SOGLREV}
-	@if [ -d ${INSTALL_libdir} ]; then set +x; \
-	else (set -x; ${MKDIR} ${INSTALL_libdir}); fi
-	${INSTALL} ${INSTALLFLAGS} ${INSTBINFLAGS} lib${LIBNAME}.so.${SOGLREV} ${INSTALL_libdir}
-	@T=`echo ${INSTALL_libdir}/lib${LIBNAME}.so.${SOGLREV} | sed 's/\.[^\.]*$$//'`; set -x; ${RM} $$T && ${LN} lib${LIBNAME}.so.${SOGLREV} $$T
-	${RM} ${INSTALL_libdir}/lib${LIBNAME}.so
-	${LN} lib${LIBNAME}.so.${SOGLREV} ${INSTALL_libdir}/lib${LIBNAME}.so
-else
-install: lib${LIBNAME}.a
-	@if [ -d ${INSTALL_libdir} ]; then set +x; \
-	else (set -x; ${MKDIR} ${INSTALL_libdir}); fi
-	${INSTALL} ${INSTALLFLAGS} ${INSTBINFLAGS} lib${LIBNAME}.a ${INSTALL_libdir}
-endif
+install: lib${LIBNAME}.la
+	${LIBTOOL} ${BSD_INSTALL_DATA} $< ${INSTALL_libdir}
 
 tags :
 	${TAGS} -w *.[ch]
@@ -92,15 +69,9 @@
 render.c: genlib.tcl genGL.tcl
 	${TCLSH} genlib.tcl
 
-lib${LIBNAME}.so.${SOGLREV} : render.c ${OBJS}
-	${RM} $@~
-	@SONAME=`echo $@ | sed 's/\.[^\.]*$$//'`; set -x; \
-	${CC} -o ./$@~ ${SHARED_LDFLAGS} -Wl,-soname,$$SONAME ${OBJS} ${XLIBDIR} -lX11 -lXi ${MATHLIBS}; \
-	${RM} $$SONAME; ${LN} $@ $$SONAME; \
-	${RM} $@
-	${MV} $@~ $@
-	${RM} lib${LIBNAME}.so
-	${LN} $@ lib${LIBNAME}.so
+lib${LIBNAME}.la : render.c ${OBJS}
+	${LIBTOOL} --mode=link ${CC} -rpath ${INSTALL_libdir} \
+	  -version-info ${SOGLREV} -o $@ ${OBJS:.o=.lo}
 
 lib${LIBNAME}.a : render.c ${UNSHARED_OBJS}
 	${RM} $@~
