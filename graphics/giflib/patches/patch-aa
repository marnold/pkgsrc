--- lib/Makefile.orig	Thu Jun 26 20:07:56 1997
+++ lib/Makefile	Wed Sep 24 08:51:35 1997
@@ -11,9 +11,10 @@
 
 #
 # Where all the include files are:
-INCS = -I.
+INCS = -I. -I${X11BASE}/include
 
-LIBDIR = /usr/lib
+INCDIR = ${PREFIX}/include/giflib
+LIBDIR = ${PREFIX}/lib
 
 #
 # What devices we should be able to grab into gif images. Note that if
@@ -63,14 +64,22 @@
 CC = gcc
 #
 #CFLAGS = -fno-builtin -O -c -W -Wreturn-type -Wcomment
-CFLAGS = -fno-builtin -g -c -W -Wreturn-type -Wcomment
+#CFLAGS = -fno-builtin -g -c -W -Wreturn-type -Wcomment
 
 
 OBJS = dev2gif.o egif_lib.o dgif_lib.o gifalloc.o gif_font.o gif_hash.o \
 	gif_err.o quantize.o qprintf.o getarg.o
 
+SOBJS = dev2gif.so egif_lib.so dgif_lib.so gifalloc.so gif_font.so \
+	gif_hash.so gif_err.so quantize.so qprintf.so getarg.so
+
+.SUFFIXES: .o .so
+
 .c.o:
-	$(CC) $(INCS) $(DEVS) $(CFLAGS) $<
+	$(CC) -c $(INCS) $(DEVS) $(CFLAGS) $<
+
+.c.so:
+	$(CC) -c $(INCS) $(DEVS) $(CFLAGS) -fpic -DPIC -o $@ $<
 
 all: static shared
 
@@ -82,9 +91,9 @@
 	ar rcv libgif.a $(OBJS)
 	-ranlib libgif.a
 
-$(SHLIB): $(OBJS)
+$(SHLIB): $(SOBJS)
 	rm -f libgif.so.$(V)
-	gcc -shared -o $(SHLIB) $(OBJS)
+	ld -Bshareable -o $(SHLIB) $(SOBJS)
 
 dev2gif.o: gif_lib.h
 egif_lib.o: gif_lib.h gif_hash.h
@@ -99,6 +108,8 @@
 
 install-lib: libgif.a
 	cp libgif.a libgif.so.$(V) $(LIBDIR)
+	mkdir -p $(INCDIR)
+	cp *.h $(INCDIR)
 
 uninstall-lib: shared static
 	rm -f $(LIBDIR)/libgif.a $(LIBDIR)/$(SHLIB)
