$NetBSD: patch-ae,v 1.1.1.1 1999/11/30 00:01:38 dmcmahill Exp $

--- kodak/kodak_dc210.c.orig	Thu Nov 25 00:00:33 1999
+++ kodak/kodak_dc210.c	Thu Nov 25 00:18:45 1999
@@ -372,7 +372,7 @@
 
   struct termios newt, oldt;
 
-  serialdev = open(devname, O_RDWR|O_NOCTTY);
+  serialdev = open(devname, O_RDWR|O_NOCTTY|O_NONBLOCK);
 
   if (serialdev < 0) 
     error_dialog("Cannot open device");
@@ -384,10 +384,11 @@
 
   /* need the device to be raw. 8 bits no parity on 9600 baud to start.  */
   cfmakeraw(&newt);
-  newt.c_oflag &= ~CSTOPB;
+  newt.c_cflag &= ~CSTOPB;
   newt.c_cflag &= ~PARENB;
   newt.c_cflag |= CS8;
   newt.c_cflag &= ~PARODD;
+  newt.c_cflag |= CRTSCTS;
 
   newt.c_cc[VMIN] = 0;
   newt.c_cc[VTIME] = 10;
@@ -594,10 +595,16 @@
       memcpy(imData,bmpHeader, sizeof(bmpHeader));
 
       /* reverse the thumbnail data */
-      for (j=fileSize-1,i=54; j >= 0 ; j--)
-      {
-	imData[i++] = picData[j];
-      }
+      /* not only is the data reversed but the image is flipped
+       * left to right
+       */
+      for (i = 0; i < 72; i++) {
+         for (j = 0; j < 96; j++) {
+            imData[i*96*3+j*3+54] = picData[(71-i)*96*3+j*3+2];
+            imData[i*96*3+j*3+54+1] = picData[(71-i)*96*3+j*3+1];
+            imData[i*96*3+j*3+54+2] = picData[(71-i)*96*3+j*3];
+            }
+         }
 
       strcpy ( im->image_type, "bmp" );
       im->image_info = NULL;
