$NetBSD: patch-cb,v 1.1.2.2 2006/11/29 17:16:35 ghen Exp $

--- src/modules/loaders/loader_jpeg.c.orig	2006-09-05 02:37:07.000000000 +0200
+++ src/modules/loaders/loader_jpeg.c
@@ -95,6 +95,13 @@ load(ImlibImage * im, ImlibProgressFunct
         UNSET_FLAG(im->flags, F_HAS_ALPHA);
         im->format = strdup("jpeg");
      }
+   if (w < 1 || h < 1 || w > 16383 || h > 16383)
+     {
+       im->w = im->h = 0;
+       jpeg_destroy_decompress(&cinfo);
+       fclose(f);
+       return 0;
+     }
    if (((!im->data) && (im->loader)) || (immediate_load) || (progress))
      {
         DATA8              *ptr, *line[16], *data;
