$NetBSD: patch-aa,v 1.1.1.1 2001/04/14 12:58:56 kei Exp $

--- texk/web2c/ptex-src-2.1.10/Makefile.in.orig	Tue Feb 29 18:09:41 2000
+++ texk/web2c/ptex-src-2.1.10/Makefile.in	Tue May  2 05:04:25 2000
@@ -5,8 +5,13 @@
 default: programs formats
 
-programs=ptex tftopl pltotf pdvitype jbibtex
+programs=ptex ptftopl ppltotf pdvitype pjbibtex
 formats=ptex.fmt platex.fmt
 
 ac_include ../../make/paths.mk
+# 
+texmflcl = @texmflocal@
+web2c_lcl_dir = $(texmflcl)/web2c
+fmt_lcl_dir = $(web2c_lcl_dir)
+texpool_lcl_dir = $(web2c_lcl_dir)
 
 # Used for triptrap.
@@ -106,4 +111,7 @@
 
 ### TFtoPL
+ptftopl: tftopl
+	rm -f ptftopl
+	$(LN) tftopl ptftopl
 tftopl: tftopl.o $(plib_o) $(kpathsea) $(proglib)
 	$(kpathsea_link) tftopl.o $(plib_o) $(LOADLIBES)
@@ -116,4 +124,7 @@
 
 ### PLtoTF
+ppltotf: pltotf
+	rm -f ppltotf
+	$(LN) pltotf ppltotf
 pltotf: pltotf.o $(plib_o) $(kpathsea) $(proglib)
 	$(kpathsea_link) pltotf.o $(plib_o) $(LOADLIBES)
@@ -136,4 +147,7 @@
 
 ### jBibTeX
+pjbibtex: jbibtex
+	rm -f pjbibtex
+	$(LN) jbibtex pjbibtex
 jbibtex: jbibtex.o jbibextra.o $(plib_o) $(kpathsea) $(proglib)
 	$(kpathsea_link) jbibtex.o jbibextra.o $(plib_o) $(LOADLIBES)
@@ -176,5 +190,10 @@
 	$(SHELL) $(thisdir)/mkconf $< > texmf.cnf
 
-dumpenv = TEXMFCNF=$(thisdir) TEXMF=$(texmf)
+#dumpenv = TEXMFCNF=$(thisdir) TEXMF=$(texmf)
+newtexmf = $(srcdir)/../../texmf
+newtexmflcl = $(srcdir)/../../texmf.local
+texin = $(srcdir):{$(newtexmf),$(newtexmflcl)}/ptex//
+texfonts = {$(newtexmf),$(newtexmflcl)}/fonts/tfm/ptex//
+dumpenv = TEXMFCNF=../../kpathsea TEXINPUTS=.:$(texin): TEXFONTS=$(texfonts):
 
 ptex.fmt: ptex texmf.cnf
@@ -213,5 +232,5 @@
 # The actual binary executables and pool files.
 install-programs: $(programs)
-	$(SHELL) $(top_srcdir)/mkinstalldirs $(bindir) $(texpooldir)
+	$(SHELL) $(top_srcdir)/mkinstalldirs $(bindir) $(texpool_lcl_dir)
 	for p in $(programs); do $(INSTALL_LIBTOOL_PROG) $(bindir) $$p; done
 
@@ -219,23 +238,23 @@
 install-links: install-programs
 	cd $(bindir) && \
-	(rm -f iniptex virptex; $(LN) ptex iniptex; $(LN) ptex virptex)
+	(rm -f iniptex virptex platex; $(LN) ptex iniptex; $(LN) ptex virptex; $(LN) ptex platex)
 
 # Always do plain.*, so examples from the TeXbook (etc.) will work.
 install-formats: $(formats)
-	$(SHELL) $(top_srcdir)/mkinstalldirs $(fmtdir)
-	for f in $(formats); do $(INSTALL_DATA) $$f $(fmtdir)/$$f; done
+	$(SHELL) $(top_srcdir)/mkinstalldirs $(fmt_lcl_dir)
+	for f in $(formats); do $(INSTALL_DATA) $$f $(fmt_lcl_dir)/$$f; done
 
 # Auxiliary files.
 install-data::
 	$(SHELL) $(top_srcdir)/mkinstalldirs \
-		$(texpooldir) $(web2cdir) $(fontnamedir)
-	$(INSTALL_DATA) ptex.pool $(texpooldir)/ptex.pool
-	if [ -f $(web2cdir)/texmf.cnf ]; then \
-		mv -f $(web2cdir)/texmf.cnf $(web2cdir)/texmf.cnf.orig ;\
+		$(texpool_lcl_dir) $(web2c_lcl_dir) $(fontnamedir)
+	$(INSTALL_DATA) ptex.pool $(texpool_lcl_dir)/ptex.pool
+	if [ -f $(web2c_lcl_dir)/texmf.cnf ]; then \
+		mv -f $(web2c_lcl_dir)/texmf.cnf $(web2c_lcl_dir)/texmf.cnf.orig ;\
 	else true; fi
-	$(INSTALL_DATA) texmf.cnf $(web2cdir)/texmf.cnf
+	$(INSTALL_DATA) texmf.cnf $(web2c_lcl_dir)/texmf.cnf
 # tcx files
 #	cd $(thisdir)/share && \
-#	for f in *.tcx; do $(INSTALL_DATA) $$f $(web2cdir)/$$f; done
+#	for f in *.tcx; do $(INSTALL_DATA) $$f $(web2c_lcl_dir)/$$f; done
 # map files are not provided with pTeX
 #	cd $(thisdir)/share && \
