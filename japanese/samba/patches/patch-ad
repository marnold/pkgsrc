$NetBSD: patch-ad,v 1.1.1.1 2000/08/30 17:29:44 kei Exp $

--- client/client.c.orig	Tue Apr 25 19:06:41 2000
+++ client/client.c	Fri Apr 28 16:29:58 2000
@@ -1598,22 +1598,19 @@
 	return True;
 }
 
-#if defined(HAVE_LIBREADLINE)
+#if defined(HAVE_READLINE)
 #  if defined(HAVE_READLINE_HISTORY_H) || defined(HAVE_HISTORY_H)
 /****************************************************************************
 history
 ****************************************************************************/
 static void cmd_history(void)
 {
-	HIST_ENTRY **hlist;
 	register int i;
 
-	hlist = history_list ();	/* Get pointer to history list */
-	
-	if (hlist)			/* If list not empty */
+	if (history_length)		/* If history is not empty */
 	{
-		for (i = 0; hlist[i]; i++)	/* then display it */
-			DEBUG(0, ("%d: %s\n", i, hlist[i]->line));
+		for (i = 1; i <= history_length; i++)	/* then display it */
+			DEBUG(0, ("%d: %s\n", i, history_get(i)->line));
 	}
 }
 #  endif 
@@ -1675,7 +1672,7 @@
   {"setmode",cmd_setmode,"filename <setmode string> change modes of file",{COMPL_REMOTE,COMPL_NONE}},
   {"help",cmd_help,"[command] give help on a command",{COMPL_NONE,COMPL_NONE}},
   {"?",cmd_help,"[command] give help on a command",{COMPL_NONE,COMPL_NONE}},
-#ifdef HAVE_LIBREADLINE
+#ifdef HAVE_READLINE
   {"history",cmd_history,"displays the command history",{COMPL_NONE,COMPL_NONE}},
 #endif
   {"!",NULL,"run a shell command on the local system",{COMPL_NONE,COMPL_NONE}},
@@ -1735,7 +1732,7 @@
 	}
 }
 
-#ifndef HAVE_LIBREADLINE
+#ifndef HAVE_READLINE
 /****************************************************************************
 wait for keyboard activity, swallowing network packets
 ****************************************************************************/
@@ -1814,7 +1811,7 @@
 	pstring line;
 	char *ptr;
 
-#ifdef HAVE_LIBREADLINE
+#ifdef HAVE_READLINE
 /* Minimal readline support, 29Jun1999, s.xenitellis@rhbnc.ac.uk */
 #ifdef PROMPTSIZE
 #undef PROMPTSIZE
@@ -1828,7 +1825,7 @@
 	while (!feof(stdin)) {
 		fstring tok;
 		int i;
-#ifdef HAVE_LIBREADLINE
+#ifdef HAVE_READLINE
 		if ( temp != (char *)NULL )
 		{
 			free( temp );	/* Free memory allocated every time by readline() */
@@ -2215,7 +2212,7 @@
 
 	DEBUGLEVEL = 2;
 
-#ifdef HAVE_LIBREADLINE
+#ifdef HAVE_READLINE
 	/* Allow conditional parsing of the ~/.inputrc file. */
 	rl_readline_name = "smbclient";
 #endif    
