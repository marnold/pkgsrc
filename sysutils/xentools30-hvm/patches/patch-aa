$NetBSD: patch-aa,v 1.1.1.1 2006/10/19 22:58:21 bouyer Exp $

--- Makefile.orig	2006-10-04 04:27:58.000000000 +0200
+++ Makefile	2006-10-18 17:33:39.000000000 +0200
@@ -2,31 +2,11 @@
 include $(XEN_ROOT)/tools/Rules.mk
 
 SUBDIRS-y :=
-SUBDIRS-y += libxc
-SUBDIRS-y += xenstore
-SUBDIRS-y += misc
-SUBDIRS-y += examples
-SUBDIRS-y += xentrace
-SUBDIRS-$(CONFIG_XCUTILS) += xcutils
-SUBDIRS-$(CONFIG_X86) += firmware
-SUBDIRS-y += security
-SUBDIRS-y += console
-SUBDIRS-y += xenmon
-SUBDIRS-y += guest-headers
-SUBDIRS-$(VTPM_TOOLS) += vtpm_manager
-SUBDIRS-$(VTPM_TOOLS) += vtpm
-SUBDIRS-y += xenstat
-SUBDIRS-y += libaio
-SUBDIRS-y += blktap
-
-# These don't cross-compile
-ifeq ($(XEN_COMPILE_ARCH),$(XEN_TARGET_ARCH))
-SUBDIRS-y += python
-SUBDIRS-y += pygrub
-endif
+SUBDIRS-y += firmware
 
 .PHONY: all
 all: check
+	(cd libxc ; $(MAKE) mk-symlinks)
 	@set -e; for subdir in $(SUBDIRS-y); do \
 		$(MAKE) -C $$subdir $@; \
 	done
@@ -53,18 +33,16 @@
 
 .PHONY: check
 check:
-	$(MAKE) -C check
 
 .PHONY: check_clean
 check_clean:
-	$(MAKE) -C check clean
 
 .PHONY: ioemu ioemuinstall ioemuclean
 ifdef CONFIG_IOEMU
 export IOEMU_DIR ?= ioemu
 ioemu ioemuinstall:
 	[ -f $(IOEMU_DIR)/config-host.mak ] || \
-	  (cd $(IOEMU_DIR) && sh configure --prefix=/usr)
+	  (cd $(IOEMU_DIR) && sh configure --prefix=$(PREFIX))
 	$(MAKE) -C $(IOEMU_DIR) $(patsubst ioemu%,%,$@)
 ioemuclean:
 	$(MAKE) -C $(IOEMU_DIR) distclean
