$NetBSD: patch-aw,v 1.1.1.1 2006/07/02 16:49:31 bouyer Exp $

--- misc/Makefile.orig	2006-04-10 00:05:53.000000000 +0200
+++ misc/Makefile	2006-05-05 22:18:12.000000000 +0200
@@ -15,25 +15,27 @@
 
 TARGETS  = xenperf xc_shadow
 
-INSTALL_BIN  = $(TARGETS) xencons
-INSTALL_SBIN = netfix xm xen-bugtool xend xenperf
+INSTALL_BIN  = $(TARGETS)
+INSTALL_BIN_SCRIPT  = xencons
+INSTALL_SBIN = xenperf
+INSTALL_SBIN_SCRIPT = netfix xm xen-bugtool xend
 
 all: build
 build: $(TARGETS)
 	$(MAKE) -C miniterm
 	$(MAKE) -C cpuperf
 ifneq ($(XEN_TARGET_ARCH),ia64)
-	$(MAKE) -C mbootpack
+#	$(MAKE) -C mbootpack
 endif
-	$(MAKE) -C lomount
 
 install: build
-	[ -d $(DESTDIR)/usr/bin ] || $(INSTALL_DIR) $(DESTDIR)/usr/bin
-	[ -d $(DESTDIR)/usr/sbin ] || $(INSTALL_DIR) $(DESTDIR)/usr/sbin
-	$(INSTALL_PROG) $(INSTALL_BIN) $(DESTDIR)/usr/bin
-	$(INSTALL_PROG) $(INSTALL_SBIN) $(DESTDIR)/usr/sbin
+	$(BSD_INSTALL_PROGRAM_DIR) $(PREFIX)/bin
+	$(BSD_INSTALL_PROGRAM_DIR) $(PREFIX)/sbin
+	$(BSD_INSTALL_PROGRAM) $(INSTALL_BIN) $(PREFIX)/bin
+	$(BSD_INSTALL_SCRIPT) $(INSTALL_BIN_SCRIPT) $(PREFIX)/bin
+	$(BSD_INSTALL_PROGRAM) $(INSTALL_SBIN) $(PREFIX)/sbin
+	$(BSD_INSTALL_SCRIPT) $(INSTALL_SBIN_SCRIPT) $(PREFIX)/sbin
 	$(MAKE) -C cpuperf install
-	$(MAKE) -C lomount install
 #       No sense in installing miniterm on the Xen box.
 #	$(MAKE) -C miniterm install
 #       Likewise mbootpack
@@ -50,4 +52,4 @@
 	$(CC) -c $(CFLAGS) -o $@ $<
 
 $(TARGETS): %: %.o Makefile
-	$(CC) $(CFLAGS) -o $@ $< -L$(XEN_LIBXC) -lxenctrl
+	$(CC) $(CFLAGS) -o $@ $< $(LDFLAGS) -L$(XEN_LIBXC) -lxenctrl
