$NetBSD: patch-de,v 1.2.2.1 2003/03/02 10:24:18 agc Exp $

--- ksysguard/ksysguardd/FreeBSD/apm.c.orig	Tue Sep 18 15:03:53 2001
+++ ksysguard/ksysguardd/FreeBSD/apm.c
@@ -20,6 +20,14 @@
 */
 
+#if defined(__NetBSD_APM__)
+
 #include <fcntl.h>
+#if defined(__NetBSD__)
+#include <machine/apmvar.h>
+#include <sys/ioctl.h>
+#include <unistd.h>
+#else
 #include <machine/apm_bios.h>
+#endif
 #include <stdio.h>
 
@@ -63,6 +71,14 @@ int
 updateApm(void)
 {
-	struct apm_info info;
 	int retval;
+#if defined(__NetBSD__)
+	struct apm_power_info info;
+
+	retval = ioctl(ApmFD, APM_IOC_GETPOWER, &info);
+
+	BattFill = info.battery_life;
+	BattTime = info.minutes_left;
+#else
+	struct apm_info info;
 
 	retval = ioctl(ApmFD, APMIO_GETINFO, &info);
@@ -70,4 +86,5 @@ updateApm(void)
 	BattFill = info.ai_batt_life;
 	BattTime = info.ai_batt_time;
+#endif
 
 	return retval;
@@ -97,2 +114,22 @@ printApmBatTimeInfo(const char* c)
 	fprintf(CurrentClient, "Remaining battery time\t0\t0\tmin\n");
 }
+
+#else
+
+void
+initApm(void)
+{
+}
+
+void
+exitApm(void)
+{
+}
+
+int
+updateApm(void)
+{
+	return -1;
+}
+
+#endif
