$NetBSD: patch-ai,v 1.10.2.1 2005/11/27 21:18:50 snj Exp $

Security fixes for CVE-2005-2975 and CVE-2005-3186.

--- gdk-pixbuf/io-xpm.c.orig	2005-08-18 16:10:56.000000000 +0200
+++ gdk-pixbuf/io-xpm.c	2005-11-26 09:46:35.000000000 +0100
@@ -1167,7 +1167,8 @@ file_buffer (enum buf_op op, gpointer ha
 		/* Fall through to the xpm_read_string. */
 
 	case op_body:
-		xpm_read_string (h->infile, &h->buffer, &h->buffer_size);
+		if(!xpm_read_string (h->infile, &h->buffer, &h->buffer_size))
+			return NULL;
 		return h->buffer;
 
 	default:
@@ -1262,7 +1263,9 @@ pixbuf_create_from_xpm (const gchar * (*
                              _("XPM has invalid number of chars per pixel"));
 		return NULL;
 	}
-	if (n_col <= 0 || n_col >= G_MAXINT / (cpp + 1)) {
+	if (n_col <= 0 || 
+	    n_col >= G_MAXINT / (cpp + 1) || 
+	    n_col >= G_MAXINT / sizeof (XPMColor)) {
                 g_set_error (error,
                              GDK_PIXBUF_ERROR,
                              GDK_PIXBUF_ERROR_CORRUPT_IMAGE,
