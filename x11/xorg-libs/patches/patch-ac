$NetBSD: patch-ac,v 1.9.2.1 2006/08/23 23:30:32 salo Exp $

--- config/cf/NetBSD.cf.in.orig	2006-04-28 23:09:24.000000000 +0200
+++ config/cf/NetBSD.cf.in
@@ -126,7 +126,7 @@ XCOMM operating system:  OSName (OSMajor
 # if ((OSMajorVersion == 2 && OSMinorVersion == 99 && OSTeenyVersion < 11) || \
       (OSMajorVersion == 2 && OSMinorVersion < 99) || \
       (OSMajorVersion < 2))
-#  define LibraryMTDefines	-DUSE_NBSD_THREADLIB
+#  define LibraryMTDefines	@@NETBSD_THREADLIB@@
 # endif
 # define SystemMTDefines	-D_REENTRANT
 # define MTSafeAPIDefines	-DXUSE_MTSAFE_API -DXNO_MTSAFE_PWDAPI
@@ -150,7 +150,7 @@ XCOMM operating system:  OSName (OSMajor
 #define MkdirHierCmd		mkdir -p
 
 #undef CcCmd
-#define CcCmd 			gcc
+#define CcCmd 			@@PKGSRC_CC@@
 #ifndef DefaultCCOptions
 #if defined(UseInstalled)
 #define DefaultCCOptions 	/**/
@@ -166,7 +166,7 @@ XCOMM operating system:  OSName (OSMajor
 #endif
 #endif
 
-#define CppCmd			cpp
+#define CppCmd			@@PKGSRC_CPP@@
 #define StandardCppOptions	-traditional
 #define StandardCppDefines	/**/
 #define PreProcessCmd   	CcCmd -E
@@ -195,7 +195,7 @@ XCOMM operating system:  OSName (OSMajor
  * Disabled for NetBSD/vax until I figure out the scheme. --CS 
  */
 #if ((OSMajorVersion > 0) && defined(i386Architecture)) || \
-    defined(PpcArchitecture)
+    defined(PpcArchitecture) || defined(AMD64Architecture)
 #  ifndef DoLoadableServer
 #  define DoLoadableServer	YES
 #  endif
@@ -231,7 +231,7 @@ XCOMM operating system:  OSName (OSMajor
 #  define ServerExtraSysLibs	-li386
 # endif
 #else
-# define OptimizedCDebugFlags 	-O2
+# define OptimizedCDebugFlags 	-O2 GccAliasingArgs
 # if defined(SparcArchitecture)
 #  define ServerOSDefines 	-DDDXOSINIT
 # elif defined(AlphaArchitecture)
@@ -240,17 +240,24 @@ XCOMM operating system:  OSName (OSMajor
 #   define ServerOSDefines	XFree86ServerOSDefines -DDDXTIME
 # elif defined(PpcArchitecture)
 #  define ServerOSDefines	XFree86ServerOSDefines -DDDXTIME -DDDXOSINIT
+# elif defined(AMD64Architecture)
+#  define ServerOSDefines	XFree86ServerOSDefines
+#  define ServerExtraSysLibs	-lx86_64
 # else
 #  define ServerOSDefines 	/**/
 # endif
 # if defined(AlphaArchitecture)
 #  define ServerExtraSysLibs	-lalpha
-# else
+# elif !defined(ServerExtraSysLibs)
 #  define ServerExtraSysLibs	/**/
 # endif
 #endif
-#ifdef i386Architecture
-# define ServerExtraDefines GccGasOption XFree86ServerDefines
+#if defined(i386Architecture) || defined(AMD64Architecture)
+#  if defined(AMD64Architecture)
+#   define ServerExtraDefines XFree86ServerDefines -D_XSERVER64
+#  else
+#   define ServerExtraDefines GccGasOption XFree86ServerDefines
+#  endif
 # ifndef XFree86ConsoleDefines
 #  if (OSMajorVersion == 1 && ((OSMinorVersion == 3 && OSTeenyVersion >= 6) \
 	                       || OSMinorVersion >= 4) \
@@ -284,6 +291,8 @@ XCOMM operating system:  OSName (OSMajor
 #  ifndef XFree86ConsoleDefines
 #    define XFree86ConsoleDefines	-DWSCONS_SUPPORT
 #  endif
+#elif defined(ia64Architecture)
+#  define ServerExtraDefines GccGasOption XFree86ServerDefines -D_XSERVER64
 #else
 #  define ServerExtraDefines GccGasOption
 #endif
@@ -404,6 +413,10 @@ XCOMM operating system:  OSName (OSMajor
 # endif /* MTRRBuiltin */
 #endif /* i386Architecture */
 
+#if defined(AMD64Architecture)
+# define HasMTRRBuiltin                YES
+#endif
+
 /*
  * agpgart support (NetBSD 1.5Y and up)
  */
@@ -420,7 +433,7 @@ XCOMM operating system:  OSName (OSMajor
  * MMX, SSE and 3DNow will be autodetected. NetBSD 1.6 and up have the
  * necessary kernel and toolchain support.
  */
-#if defined(i386Architecture) &&  \
+#if (defined(i386Architecture) || defined(AMD64Architecture)) &&  \
 	((OSMajorVersion > 1) || (OSMajorVersion == 1 && OSMinorVersion > 5))
 # define HasX86Support          YES
 # define HasMMXSupport          YES
@@ -590,7 +603,7 @@ InstallManPageAliasesBase(file,destdir,a
 # define BuildXInputLib          YES
 #endif
 
-#if defined(i386Architecture) || defined(Arm32Architecture) || defined(AlphaArchitecture) || defined(PpcArchitecture)
+#if defined(i386Architecture) || defined(Arm32Architecture) || defined(AlphaArchitecture) || defined(PpcArchitecture) || defined(AMD64Architecture)
 # include <xorg.cf>
 #endif
 
@@ -651,7 +664,7 @@ sed 's/\.[0-9]*$$//'`
  */
 #ifdef PpcArchitecture
 
-# define OptimizedCDebugFlags 	-O2
+# define OptimizedCDebugFlags 	-O2 GccAliasingArgs
 # define XkbServerDefines	-DXKB_ALWAYS_USES_SOFT_REPEAT
 
 # ifndef DoLoadableServer
