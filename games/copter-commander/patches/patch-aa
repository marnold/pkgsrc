$NetBSD: patch-aa,v 1.1.1.1 2002/03/08 16:45:36 wiz Exp $

--- Makefile.orig	Fri Feb  8 23:12:31 2002
+++ Makefile
@@ -54,7 +54,7 @@
 
 
 # INSTALLATION LOCATIONS
-COCO_INSTALL_DIRECTORY=/usr/local
+COCO_INSTALL_DIRECTORY=${PREFIX}
 COCO_BIN_DIRECTORY=${COCO_INSTALL_DIRECTORY}/bin
 COCO_SHARE_DIRECTORY=${COCO_INSTALL_DIRECTORY}/share/copter-commander/${COCO_MAJOR_VERSION}.${COCO_MINOR_VERSION}
 COCO_DOC_DIRECTORY=${COCO_SHARE_DIRECTORY}/doc
@@ -79,23 +79,23 @@
 COCO_GII_INCLUDE_DIRECTORY=/usr/include
 
 # X11 (glx-copter-commander only)
-COCO_X11_LIB_DIRECTORY=/usr/X11R6/lib
-COCO_X11_INCLUDE_DIRECTORY=/usr/X11R6/include
+COCO_X11_LIB_DIRECTORY=${X11BASE}/lib
+COCO_X11_INCLUDE_DIRECTORY=${X11BASE}/include
 
 # GtkGLArea (copter-commander only)
-COCO_GTKGLAREA_LIB_DIRECTORY=/usr/lib
-COCO_GTKGLAREA_INCLUDE_DIRECTORY=/usr/include
+COCO_GTKGLAREA_LIB_DIRECTORY=${X11PREFIX}/lib
+COCO_GTKGLAREA_INCLUDE_DIRECTORY=${X11PREFIX}/include
 
 # Gnome (handled by the gnome-config script)
 
 # OpenGL (According to http://oss.sgi.com/projects/ogl-sample/ABI, these
 # should be as shown, if not, consider making a symlink)
-COCO_GL_LIB_DIRECTORY=/usr/lib
-COCO_GL_INCLUDE_DIRECTORY=/usr/include
+COCO_GL_LIB_DIRECTORY=${X11PREFIX}/usr/lib
+COCO_GL_INCLUDE_DIRECTORY=${X11PREFIX}/include
 
 # LibTIFF image library
-COCO_LIBTIFF_LIB_DIRECTORY=/usr/lib
-COCO_LIBTIFF_INCLUDE_DIRECTORY=/usr/include
+COCO_LIBTIFF_LIB_DIRECTORY=${LOCALBASE}/lib
+COCO_LIBTIFF_INCLUDE_DIRECTORY=${LOCALBASE}/include
 
 # Sound Support
 # Select the sound technique that works for you, valid values are 
@@ -112,8 +112,8 @@
 COCO_OPENAL_INCLUDE_DIRECTORY=/usr/local/include
 
 # ESD sound library (only used if COCO_SOUND=esd)
-COCO_ESD_LIB_DIRECTORY=/usr/lib
-COCO_ESD_INCLUDE_DIRECTORY=/usr/include
+COCO_ESD_LIB_DIRECTORY=${LOCALBASE}/lib
+COCO_ESD_INCLUDE_DIRECTORY=${LOCALBASE}/include
 COCO_ESD_LIBS=-lesd
 
 
@@ -155,7 +155,7 @@
 COCO_SOUND_LINK_LINE=-L${COCO_OPENAL_LIB_DIRECTORY} ${COCO_OPENAL_LIBS}
 else
 ifeq (${COCO_SOUND},esd)
-COCO_SOUND_LINK_LINE=-L${COCO_ESD_LIB_DIRECTORY} ${COCO_ESD_LIBS}
+COCO_SOUND_LINK_LINE=-L${COCO_ESD_LIB_DIRECTORY} -Wl,-R${COCO_ESD_LIB_DIRECTORY} ${COCO_ESD_LIBS}
 else
 #assign null string:
 COCO_SOUND_LINK_LINE=
@@ -350,11 +350,11 @@
 	  `gnome-config --cflags gnomeui`
 
 client.o: client.c
-	${CC} ${CFLAGS_UNANSI} -c client.c ${COCO_GII_INCLUDE_ARGUMENTS}
+	${CC} ${CFLAGS_UNANSI} -c client.c -I${COCO_GL_INCLUDE_DIRECTORY} ${COCO_GII_INCLUDE_ARGUMENTS}
 
 screenshot.o: screenshot.c 
 	${CC} ${CFLAGS} -c screenshot.c -o $@ \
-          -I${COCO_LIBTIFF_INCLUDE_DIRECTORY}
+          -I${COCO_LIBTIFF_INCLUDE_DIRECTORY} -I${COCO_GL_INCLUDE_DIRECTORY}
 
 # build other objects the standard way
 %.o: %.c 
@@ -367,10 +367,10 @@
 GNOME_LINK_LINE=\
 ${CC} ${CFLAGS} -o $@ ${GAME_OBJ_FILES} ${GNOME_OBJ_FILES} ${USED_SOUND_OBJ_FILES} ${COCO_RASTER_DIRECTORY}/*.o \
 ${COCO_BASIC_LIBS} \
--L${COCO_LIBTIFF_LIB_DIRECTORY} -ltiff \
--L${COCO_GL_LIB_DIRECTORY} -lGL \
+-Wl,-R${COCO_LIBTIFF_LIB_DIRECTORY} -L${COCO_LIBTIFF_LIB_DIRECTORY} -ltiff \
+-Wl,-R${COCO_GL_LIB_DIRECTORY} -L${COCO_GL_LIB_DIRECTORY} -lGL \
 `gnome-config --libs gnome gnomeui` \
--L${COCO_GTKGLAREA_LIB_DIRECTORY} -lgtkgl \
+-Wl,-R${COCO_GTKGLAREA_LIB_DIRECTORY} -L${COCO_GTKGLAREA_LIB_DIRECTORY} -lgtkgl \
 ${COCO_GII_LINK_ARGUMENTS}
 
 
@@ -380,9 +380,9 @@
 GLX_LINK_LINE=\
 ${CC} ${CFLAGS} -o $@ ${GAME_OBJ_FILES} ${GLX_OBJ_FILES} ${USED_SOUND_OBJ_FILES} ${COCO_RASTER_DIRECTORY}/*.o \
 ${COCO_BASIC_LIBS} \
--L${COCO_LIBTIFF_LIB_DIRECTORY} -ltiff \
--L${COCO_X11_LIB_DIRECTORY} -lX11 -lXext \
--L${COCO_GL_LIB_DIRECTORY} -lGL \
+-Wl,-R${COCO_LIBTIFF_LIB_DIRECTORY} -L${COCO_LIBTIFF_LIB_DIRECTORY} -ltiff \
+-Wl,-R${COCO_X11_LIB_DIRECTORY} -L${COCO_X11_LIB_DIRECTORY} -lX11 -lXext \
+-Wl,-R${COCO_GL_LIB_DIRECTORY} -L${COCO_GL_LIB_DIRECTORY} -lGL \
 ${COCO_GII_LINK_ARGUMENTS}
 
 glx-copter-commander: ${GAME_OBJ_FILES} ${GLX_OBJ_FILES} ${USED_SOUND_OBJ_FILES} ${COCO_RASTER_DIRECTORY}/built 
@@ -414,7 +414,7 @@
 # [ #499186 ] tiff-compile doesn't compile -dm 01-03-2002
 tiff-compile: tiff-compile.c raster.h c-header.strlit
 	${CC} ${CFLAGS_UNANSI} -I${COCO_LIBTIFF_INCLUDE_DIRECTORY} \
-	  -o $@ $@.c -L${COCO_LIBTIFF_LIB_DIRECTORY} -ltiff -lm
+	  -o $@ $@.c -Wl,-R${COCO_LIBTIFF_LIB_DIRECTORY} -L${COCO_LIBTIFF_LIB_DIRECTORY} -ltiff -lm
 
 sizeof: sizeof.c
 	${CC} ${CFLAGS} -o sizeof sizeof.c
@@ -475,19 +475,18 @@
 	gzip -c ${COCO_TAR_FILE} > ${COCO_TAR_FILE}.gz
 
 install:
-	set -e ;\
-	mkdir -p \
+	${BSD_INSTALL_DATA_DIR} \
           ${COCO_BIN_DIRECTORY} \
 	  ${COCO_SHARE_DIRECTORY} \
 	  ${COCO_DOC_DIRECTORY} \
 	  ${COCO_LEVEL_DIRECTORY} \
-	  ${COCO_SOUND_DIRECTORY} ;\
-	install copter-commander ${COCO_BIN_DIRECTORY} ;\
-	install glx-copter-commander ${COCO_BIN_DIRECTORY} ;\
-	install -m u=rw,go=r keybindings.txt manual.txt copyright ${COCO_DOC_DIRECTORY} ;\
-	install -m u=rw,go=r levels/*.ccl ${COCO_LEVEL_DIRECTORY} ;\
-	install -m u=rw,go=r levels/*.cct ${COCO_LEVEL_DIRECTORY} ;\
-	install -m u=rw,go=r sounds/*.wav ${COCO_SOUND_DIRECTORY}
+	  ${COCO_SOUND_DIRECTORY}
+	${BSD_INSTALL_PROGRAM} copter-commander ${COCO_BIN_DIRECTORY}
+	${BSD_INSTALL_PROGRAM} glx-copter-commander ${COCO_BIN_DIRECTORY}
+	${BSD_INSTALL_DATA} keybindings.txt manual.txt copyright ${COCO_DOC_DIRECTORY}
+	${BSD_INSTALL_DATA} levels/*.ccl ${COCO_LEVEL_DIRECTORY}
+	${BSD_INSTALL_DATA} levels/*.cct ${COCO_LEVEL_DIRECTORY}
+	${BSD_INSTALL_DATA} sounds/*.wav ${COCO_SOUND_DIRECTORY}
 
 COCO_RPM_RELEASE=1
 COCO_RPM_SPEC=copter-commander-${COCO_MAJOR_VERSION}.${COCO_MINOR_VERSION}-${COCO_RPM_RELEASE}.spec
